

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rmakers.makers &mdash; rmakers  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/abjad.css?v=582143d1" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../_static/uqbar.css?v=e6773f5c" />

  
    <link rel="canonical" href="https://abjad.github.io/rmakers_modules/rmakers/makers.html"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/ga.js"></script>
      <script src="../../_static/toggleprompt.js?v=5801b3bb"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #BB2299" >


    <a href="../../index.html" class="icon icon-home" alt="Documentation
    Home"> rmakers 3.31



</a>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">rmakers API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #BB2299" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rmakers</a>
      </nav>

      <div class="wy-nav-content">

<div class="rst-content style-external-links">

    


    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    <div itemprop="articleBody">
    
  <h1>Source code for rmakers.makers</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Makers.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">types</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">abjad</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">classes</span> <span class="k">as</span> <span class="n">_classes</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_apply_ties_to_split_notes</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
    <span class="n">unscaled_end_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">unscaled_preamble_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">unscaled_talea_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">talea</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Talea</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">unscaled_end_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">unscaled_end_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">unscaled_preamble_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">unscaled_preamble_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">unscaled_talea_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">unscaled_talea_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">talea</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Talea</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">talea</span><span class="p">)</span>
    <span class="n">leaves</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">written_durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">leaf</span><span class="o">.</span><span class="n">written_duration</span><span class="p">()</span> <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">]</span>
    <span class="n">total_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">written_durations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">preamble_weights</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">unscaled_preamble_counts</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">unscaled_preamble_counts</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">talea</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
            <span class="n">preamble_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
    <span class="n">preamble_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">preamble_weights</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">total_duration</span> <span class="o">&lt;=</span> <span class="n">preamble_duration</span><span class="p">:</span>
        <span class="n">preamble_parts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">partition_by_weights</span><span class="p">(</span>
            <span class="n">written_durations</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">preamble_weights</span><span class="p">,</span>
            <span class="n">allow_part_weights</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">MORE</span><span class="p">,</span>
            <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">talea_parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">preamble_duration</span> <span class="o">&lt;</span> <span class="n">total_duration</span>
        <span class="n">preamble_parts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">partition_by_weights</span><span class="p">(</span>
            <span class="n">written_durations</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">preamble_weights</span><span class="p">,</span>
            <span class="n">allow_part_weights</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">EXACT</span><span class="p">,</span>
            <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">talea_weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">numerator</span> <span class="ow">in</span> <span class="n">unscaled_talea_counts</span><span class="p">:</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">talea</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="o">*</span><span class="n">pair</span><span class="p">))</span>
            <span class="n">talea_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">preamble_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">preamble_parts</span><span class="p">))</span>
        <span class="n">talea_written_durations</span> <span class="o">=</span> <span class="n">written_durations</span><span class="p">[</span><span class="n">preamble_length</span><span class="p">:]</span>
        <span class="n">talea_parts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">partition_by_weights</span><span class="p">(</span>
            <span class="n">talea_written_durations</span><span class="p">,</span>
            <span class="n">weights</span><span class="o">=</span><span class="n">talea_weights</span><span class="p">,</span>
            <span class="n">allow_part_weights</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">MORE</span><span class="p">,</span>
            <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">overhang</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">preamble_parts</span> <span class="o">+</span> <span class="n">talea_parts</span>
    <span class="n">part_durations</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">part_durations</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">written_durations</span><span class="p">)</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">]</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">partition_by_counts</span><span class="p">(</span><span class="n">leaves</span><span class="p">,</span> <span class="n">counts</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parts</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Rest</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">part</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">tie</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
    <span class="c1"># TODO: this will need to be generalized and better tested:</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">unscaled_end_counts</span><span class="p">):</span>
        <span class="n">total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unscaled_end_counts</span><span class="p">)</span>
        <span class="n">end_leaves</span> <span class="o">=</span> <span class="n">leaves</span><span class="p">[</span><span class="o">-</span><span class="n">total</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">end_leaves</span><span class="p">):</span>
            <span class="n">previous_leaf</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">leaf</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">previous_leaf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">,</span> <span class="n">previous_leaf</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_durations_to_lcm_pairs</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Changes ``durations`` to pairs sharing LCM denominator.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; items = [abjad.Duration(2, 4), 3, (5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; durations = abjad.duration.durations(items)</span>
<span class="sd">        &gt;&gt;&gt; result = rmakers.makers._durations_to_lcm_pairs(durations)</span>
<span class="sd">        &gt;&gt;&gt; for x in result:</span>
<span class="sd">        ...     x</span>
<span class="sd">        ...</span>
<span class="sd">        (8, 16)</span>
<span class="sd">        (48, 16)</span>
<span class="sd">        (5, 16)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="n">denominators</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">denominator</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">]</span>
    <span class="n">lcm</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">least_common_multiple</span><span class="p">(</span><span class="o">*</span><span class="n">denominators</span><span class="p">)</span>
    <span class="n">fractions</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">as_fraction</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">]</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">pair_with_denominator</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">lcm</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">fractions</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pairs</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_fix_rounding_error</span><span class="p">(</span>
    <span class="n">notes</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">],</span>
    <span class="n">total_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span>
    <span class="n">interpolation</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Interpolation</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">total_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">total_duration</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Interpolation</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">interpolation</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span> <span class="o">!=</span> <span class="n">total_duration</span><span class="p">:</span>
        <span class="n">nonlast_leaf_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">notes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">needed_duration</span> <span class="o">=</span> <span class="n">total_duration</span> <span class="o">-</span> <span class="n">nonlast_leaf_duration</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="n">needed_duration</span> <span class="o">/</span> <span class="n">interpolation</span><span class="o">.</span><span class="n">written_duration</span>
        <span class="n">notes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_dmp</span><span class="p">(</span><span class="n">multiplier</span><span class="o">.</span><span class="n">as_integer_ratio</span><span class="p">())</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_function_name</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">FrameType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">function_name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
    <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;rmakers.</span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2">()&quot;</span>
    <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_interpolate_cosine</span><span class="p">(</span><span class="n">y1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
    <span class="n">mu2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu2</span><span class="p">)</span> <span class="o">+</span> <span class="n">y2</span> <span class="o">*</span> <span class="n">mu2</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_interpolate_divide</span><span class="p">(</span>
    <span class="n">total_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span>
    <span class="n">start_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span>
    <span class="n">stop_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span>
    <span class="n">exponent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">=</span> <span class="s2">&quot;cosine&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Divides ``total_duration`` into durations computed from interpolating between</span>
<span class="sd">    ``start_duration`` and ``stop_duration``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; rmakers.makers._interpolate_divide(</span>
<span class="sd">        ...     total_duration=abjad.Duration(10, 1),</span>
<span class="sd">        ...     start_duration=abjad.Duration(1, 1),</span>
<span class="sd">        ...     stop_duration=abjad.Duration(1, 1),</span>
<span class="sd">        ...     exponent=1,</span>
<span class="sd">        ... )</span>
<span class="sd">        [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]</span>
<span class="sd">        &gt;&gt;&gt; sum(_)</span>
<span class="sd">        10.0</span>

<span class="sd">        &gt;&gt;&gt; rmakers.makers._interpolate_divide(</span>
<span class="sd">        ...     total_duration=abjad.Duration(10, 1),</span>
<span class="sd">        ...     start_duration=abjad.Duration(5, 1),</span>
<span class="sd">        ...     stop_duration=abjad.Duration(1, 1),</span>
<span class="sd">        ... )</span>
<span class="sd">        [4.798..., 2.879..., 1.326..., 0.995...]</span>
<span class="sd">        &gt;&gt;&gt; sum(_)</span>
<span class="sd">        10.0</span>

<span class="sd">    Set ``exponent`` to ``&#39;cosine&#39;`` for cosine interpolation.</span>

<span class="sd">    Set ``exponent`` to a numeric value for exponential interpolation with</span>
<span class="sd">    ``exponent`` as the exponent.</span>

<span class="sd">    Scales resulting durations so that their sum equals ``total_duration`` exactly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">total_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">total_duration</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">start_duration</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stop_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">stop_duration</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">exponent</span><span class="p">)</span>
    <span class="n">zero</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">total_duration</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Total duration must be positive.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">start_duration</span> <span class="o">&lt;=</span> <span class="n">zero</span> <span class="ow">or</span> <span class="n">stop_duration</span> <span class="o">&lt;=</span> <span class="n">zero</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Both &#39;start_duration&#39; and &#39;stop_duration&#39; must be positive.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">total_duration</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">stop_duration</span> <span class="o">+</span> <span class="n">start_duration</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">float_durations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">partial_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="n">partial_sum</span> <span class="o">&lt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_duration</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exponent</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">exponent</span> <span class="o">==</span> <span class="s2">&quot;cosine&quot;</span>
            <span class="n">float_duration</span> <span class="o">=</span> <span class="n">_interpolate_cosine</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">start_duration</span><span class="p">),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">stop_duration</span><span class="p">),</span>
                <span class="n">partial_sum</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_duration</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">float_duration</span> <span class="o">=</span> <span class="n">_interpolate_exponential</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">start_duration</span><span class="p">),</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">stop_duration</span><span class="p">),</span>
                <span class="n">partial_sum</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_duration</span><span class="p">),</span>
                <span class="n">exponent</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">float_durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">float_duration</span><span class="p">)</span>
        <span class="n">partial_sum</span> <span class="o">+=</span> <span class="n">float_duration</span>
    <span class="n">float_durations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">_</span> <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_duration</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">float_durations</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">float_durations</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">float_durations</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_interpolate_exponential</span><span class="p">(</span>
    <span class="n">y1</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">y2</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpolates between ``y1`` and ``y2`` at position ``mu``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Exponents equal to 1 leave durations unscaled:</span>

<span class="sd">        &gt;&gt;&gt; for mu in (0, 0.25, 0.5, 0.75, 1):</span>
<span class="sd">        ...     rmakers.makers._interpolate_exponential(100, 200, mu, exponent=1)</span>
<span class="sd">        ...</span>
<span class="sd">        100.0</span>
<span class="sd">        125.0</span>
<span class="sd">        150.0</span>
<span class="sd">        175.0</span>
<span class="sd">        200.0</span>

<span class="sd">        Exponents greater than 1 generate ritardandi:</span>

<span class="sd">        &gt;&gt;&gt; for mu in (0, 0.25, 0.5, 0.75, 1):</span>
<span class="sd">        ...     rmakers.makers._interpolate_exponential(100, 200, mu, exponent=2)</span>
<span class="sd">        ...</span>
<span class="sd">        100.0</span>
<span class="sd">        106.25</span>
<span class="sd">        125.0</span>
<span class="sd">        156.25</span>
<span class="sd">        200.0</span>

<span class="sd">        Exponents less than 1 generate accelerandi:</span>

<span class="sd">        &gt;&gt;&gt; for mu in (0, 0.25, 0.5, 0.75, 1):</span>
<span class="sd">        ...     rmakers.makers._interpolate_exponential(100, 200, mu, exponent=0.5)</span>
<span class="sd">        ...</span>
<span class="sd">        100.0</span>
<span class="sd">        150.0</span>
<span class="sd">        170.71067811865476</span>
<span class="sd">        186.60254037844388</span>
<span class="sd">        200.0</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="o">**</span><span class="n">exponent</span><span class="p">)</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">y2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="n">exponent</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_duration_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_fraction_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Fraction</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_integer_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_integer_pair_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_integer_tuple_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_integer_or_string_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_leaf_or_tuplet_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_accelerando</span><span class="p">(</span>
    <span class="n">total_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span>
    <span class="n">interpolations</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">_classes</span><span class="o">.</span><span class="n">Interpolation</span><span class="p">],</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes notes with LilyPond multipliers; notes sum to ``total_duration``.</span>

<span class="sd">    Total number of notes not specified: total duration is specified instead.</span>

<span class="sd">    Selects interpolation specifier at ``index`` in ``interpolations``.</span>

<span class="sd">    Computes duration multipliers interpolated from interpolation specifier start to</span>
<span class="sd">    stop.</span>

<span class="sd">    Sets note written durations according to interpolation specifier.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">total_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Interpolation</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">interpolations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">interpolations_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">interpolations</span><span class="p">)</span>
    <span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolations_cycle</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">note_durations_as_floats</span> <span class="o">=</span> <span class="n">_interpolate_divide</span><span class="p">(</span>
        <span class="n">total_duration</span><span class="o">=</span><span class="n">total_duration</span><span class="p">,</span>
        <span class="n">start_duration</span><span class="o">=</span><span class="n">interpolation</span><span class="o">.</span><span class="n">start_duration</span><span class="p">,</span>
        <span class="n">stop_duration</span><span class="o">=</span><span class="n">interpolation</span><span class="o">.</span><span class="n">stop_duration</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">note_durations_as_floats</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">pitches</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_pitches</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_notes</span><span class="p">(</span><span class="n">pitches</span><span class="p">,</span> <span class="p">[</span><span class="n">total_duration</span><span class="p">],</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">tuplet</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">(</span><span class="s2">&quot;1:1&quot;</span><span class="p">,</span> <span class="n">components</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tuplet</span>
    <span class="n">note_durations</span> <span class="o">=</span> <span class="n">_round_durations</span><span class="p">(</span><span class="n">note_durations_as_floats</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">NamedPitch</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">note_durations</span><span class="p">):</span>
        <span class="n">duration_multiplier</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="n">interpolation</span><span class="o">.</span><span class="n">written_duration</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">from_duration_and_pitch</span><span class="p">(</span>
            <span class="n">interpolation</span><span class="o">.</span><span class="n">written_duration</span><span class="p">,</span>
            <span class="n">pitch</span><span class="p">,</span>
            <span class="n">dmp</span><span class="o">=</span><span class="n">duration_multiplier</span><span class="o">.</span><span class="n">as_integer_ratio</span><span class="p">(),</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span>
    <span class="n">_fix_rounding_error</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">total_duration</span><span class="p">,</span> <span class="n">interpolation</span><span class="p">)</span>
    <span class="n">tuplet</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">(</span><span class="s2">&quot;1:1&quot;</span><span class="p">,</span> <span class="n">notes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tuplet</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_components</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">increase_monotonic</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">forbidden_note_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">forbidden_rest_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">_</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="n">components</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">duration</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">duration</span><span class="p">:</span>
            <span class="n">pitch_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">NamedPitch</span><span class="p">(</span><span class="s2">&quot;c&#39;&quot;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pitch_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">components_</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_leaves</span><span class="p">(</span>
            <span class="p">[</span><span class="n">pitch_list</span><span class="p">],</span>
            <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">duration</span><span class="p">)],</span>
            <span class="n">increase_monotonic</span><span class="o">=</span><span class="n">increase_monotonic</span><span class="p">,</span>
            <span class="n">forbidden_note_duration</span><span class="o">=</span><span class="n">forbidden_note_duration</span><span class="p">,</span>
            <span class="n">forbidden_rest_duration</span><span class="o">=</span><span class="n">forbidden_rest_duration</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">components</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">components_</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_leaf_or_tuplet_list</span><span class="p">(</span><span class="n">components</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">components</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_incised_duration_lists</span><span class="p">(</span>
    <span class="n">pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">prefix_talea</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">prefix_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">suffix_talea</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">suffix_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">extra_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">incise</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Incise</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">]]:</span>
    <span class="k">assert</span> <span class="n">_is_integer_pair_list</span><span class="p">(</span><span class="n">pairs</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">prefix_talea</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">prefix_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">suffix_talea</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">suffix_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span>
    <span class="n">prefix_talea_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">prefix_talea</span><span class="p">)</span>
    <span class="n">prefix_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">prefix_counts</span><span class="p">)</span>
    <span class="n">suffix_talea_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">suffix_talea</span><span class="p">)</span>
    <span class="n">suffix_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">suffix_counts</span><span class="p">)</span>
    <span class="n">extra_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span>
    <span class="n">duration_lists</span><span class="p">,</span> <span class="n">prefix_talea_index</span><span class="p">,</span> <span class="n">suffix_talea_index</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">pair_index</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pairs</span><span class="p">):</span>
        <span class="n">prefix_length</span> <span class="o">=</span> <span class="n">prefix_counts_cycle</span><span class="p">[</span><span class="n">pair_index</span><span class="p">]</span>
        <span class="n">suffix_count</span> <span class="o">=</span> <span class="n">suffix_counts_cycle</span><span class="p">[</span><span class="n">pair_index</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">prefix_talea_index</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">prefix_talea_index</span> <span class="o">+</span> <span class="n">prefix_length</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix_talea_cycle</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">suffix_talea_index</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">suffix_talea_index</span> <span class="o">+</span> <span class="n">suffix_count</span>
        <span class="n">suffix</span> <span class="o">=</span> <span class="n">suffix_talea_counts_cycle</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
        <span class="n">prefix_talea_index</span> <span class="o">+=</span> <span class="n">prefix_length</span>
        <span class="n">suffix_talea_index</span> <span class="o">+=</span> <span class="n">suffix_count</span>
        <span class="n">extra_count</span> <span class="o">=</span> <span class="n">extra_counts_cycle</span><span class="p">[</span><span class="n">pair_index</span><span class="p">]</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">extra_count</span> <span class="o">%</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">duration_list</span> <span class="o">=</span> <span class="n">_make_duration_list</span><span class="p">(</span>
            <span class="n">numerator</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">prefix</span><span class="p">),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">suffix</span><span class="p">),</span>
            <span class="n">incise</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">duration_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">duration_list</span> <span class="ow">in</span> <span class="n">duration_lists</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">duration_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">duration_lists</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_middle_durations</span><span class="p">(</span>
    <span class="n">middle_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span>
    <span class="n">incise</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Incise</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">]:</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">middle_duration</span><span class="o">.</span><span class="n">denominator</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incise</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Incise</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">incise</span><span class="p">)</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">incise</span><span class="o">.</span><span class="n">fill_with_rests</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">incise</span><span class="o">.</span><span class="n">outer_tuplets_only</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">middle_duration</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">incise</span><span class="o">.</span><span class="n">body_proportion</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fractions</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">divide_integer_by_proportion</span><span class="p">(</span>
                        <span class="n">middle_duration</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span>
                        <span class="n">incise</span><span class="o">.</span><span class="n">body_proportion</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">assert</span> <span class="n">_is_fraction_list</span><span class="p">(</span><span class="n">fractions</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">fractions</span><span class="p">)</span>
                    <span class="n">durations_</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">durations</span><span class="p">(</span><span class="n">fractions</span><span class="p">)</span>
                    <span class="n">durations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">durations_</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">middle_duration</span><span class="p">:</span>
                <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">incise</span><span class="o">.</span><span class="n">outer_tuplets_only</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">middle_duration</span><span class="p">:</span>
                <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">middle_duration</span><span class="p">:</span>
                <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">durations</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_talea_numerator_lists</span><span class="p">(</span>
    <span class="n">pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">preamble_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">talea_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">extra_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">end_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">read_talea_once_only</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="k">assert</span> <span class="n">_is_integer_pair_list</span><span class="p">(</span><span class="n">pairs</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">pairs</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_or_string_list</span><span class="p">(</span><span class="n">talea_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">talea_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">end_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">end_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">read_talea_once_only</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">read_talea_once_only</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">prolated_pairs</span> <span class="o">=</span> <span class="n">pairs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prolated_pairs</span> <span class="o">=</span> <span class="n">_make_prolated_pairs</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">extra_counts</span><span class="p">)</span>
    <span class="n">prolated_numerators</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">prolated_pairs</span><span class="p">]</span>
    <span class="n">expanded_talea</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">talea_integer_counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">talea_counts</span> <span class="ow">or</span> <span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">talea_counts</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">)</span>
        <span class="n">prolated_numerator_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">prolated_numerators</span><span class="p">)</span>
        <span class="n">talea_counts_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">talea_counts</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">talea_counts</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">talea_counts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">talea_counts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">)</span>
        <span class="n">talea_counts_copy</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">explicit_weight</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">talea_counts_copy</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
            <span class="n">explicit_weight</span> <span class="o">=</span> <span class="n">explicit_weight</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="n">implicit_weight</span> <span class="o">=</span> <span class="n">prolated_numerator_weight</span> <span class="o">-</span> <span class="n">explicit_weight</span>
        <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">talea_counts</span><span class="p">:</span>
            <span class="n">implicit_weight</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">talea_counts_copy</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">implicit_weight</span>
        <span class="n">expanded_talea</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">talea_counts_copy</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">expanded_talea</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">talea_integer_counts</span> <span class="o">=</span> <span class="n">expanded_talea</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">talea_counts</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">talea_integer_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">numerator_lists</span> <span class="o">=</span> <span class="n">_split_talea_extended_to_weights</span><span class="p">(</span>
        <span class="n">preamble_counts</span><span class="p">,</span>
        <span class="n">prolated_numerators</span><span class="p">,</span>
        <span class="n">talea_integer_counts</span><span class="p">,</span>
        <span class="n">read_talea_once_only</span><span class="o">=</span><span class="n">read_talea_once_only</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">end_counts</span><span class="p">):</span>
        <span class="n">end_weight</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">end_counts</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">numerator_list_weights</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">numerator_lists</span>
        <span class="p">]</span>
        <span class="n">numerators</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">numerator_lists</span><span class="p">)</span>
        <span class="n">numerators_weight</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">numerators</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">end_weight</span> <span class="o">&lt;=</span> <span class="n">numerators_weight</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">end_counts</span><span class="p">)</span>
        <span class="n">left_weight</span> <span class="o">=</span> <span class="n">numerators_weight</span> <span class="o">-</span> <span class="n">end_weight</span>
        <span class="n">numerator_lists</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">numerators</span><span class="p">,</span> <span class="p">[</span><span class="n">left_weight</span><span class="p">,</span> <span class="n">end_weight</span><span class="p">])</span>
        <span class="n">numerators</span> <span class="o">=</span> <span class="n">numerator_lists</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">end_counts</span>
        <span class="k">assert</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">numerators</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">numerators_weight</span>
        <span class="n">numerator_lists</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">partition_by_weights</span><span class="p">(</span>
            <span class="n">numerators</span><span class="p">,</span>
            <span class="n">numerator_list_weights</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">_is_integer_list</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">numerator_lists</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">numerator_lists</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">numerator_lists</span><span class="p">,</span> <span class="n">expanded_talea</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_duration_list</span><span class="p">(</span>
    <span class="n">numerator</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">prefix_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">suffix_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">incise</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Incise</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">is_note_filled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">]:</span>
    <span class="n">numerator_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">numerator</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">prefix_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">prefix_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">suffix_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">suffix_counts</span><span class="p">)</span>
    <span class="n">prefix_durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">prefix_counts</span><span class="p">]</span>
    <span class="n">suffix_durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">suffix_counts</span><span class="p">]</span>
    <span class="n">prefix_weight</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">prefix_durations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">suffix_weight</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">suffix_durations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">middle_duration</span> <span class="o">=</span> <span class="n">numerator_duration</span> <span class="o">-</span> <span class="n">prefix_weight</span> <span class="o">-</span> <span class="n">suffix_weight</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">numerator_duration</span> <span class="o">&lt;</span> <span class="n">prefix_weight</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">numerator_duration</span><span class="p">]</span>
        <span class="n">prefix_durations</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">prefix_durations</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">middle_durations</span> <span class="o">=</span> <span class="n">_make_middle_durations</span><span class="p">(</span><span class="n">middle_duration</span><span class="p">,</span> <span class="n">incise</span><span class="p">)</span>
    <span class="n">suffix_space</span> <span class="o">=</span> <span class="n">numerator_duration</span> <span class="o">-</span> <span class="n">prefix_weight</span>
    <span class="k">if</span> <span class="n">suffix_space</span> <span class="o">&lt;=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">suffix_durations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="n">suffix_space</span> <span class="o">&lt;</span> <span class="n">suffix_weight</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">suffix_space</span><span class="p">]</span>
        <span class="n">suffix_durations</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">suffix_durations</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">cyclic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">prefix_durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span>
        <span class="n">prefix_durations</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">suffix_durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span>
        <span class="n">suffix_durations</span>
    <span class="p">)</span>
    <span class="n">duration_list</span> <span class="o">=</span> <span class="n">prefix_durations</span> <span class="o">+</span> <span class="n">middle_durations</span> <span class="o">+</span> <span class="n">suffix_durations</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">duration_list</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span>
        <span class="n">duration_list</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">duration_list</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_outer_tuplets_only_incised_duration_lists</span><span class="p">(</span>
    <span class="n">scaled_pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">scaled_prefix_talea_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">scaled_suffix_talea_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">scaled_extra_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">incise</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Incise</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">]]:</span>
    <span class="k">assert</span> <span class="n">_is_integer_pair_list</span><span class="p">(</span><span class="n">scaled_pairs</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">scaled_pairs</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">scaled_prefix_talea_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">scaled_suffix_talea_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">scaled_extra_counts</span><span class="p">)</span>
    <span class="n">scaled_prefix_talea_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">scaled_prefix_talea_counts</span><span class="p">)</span>
    <span class="n">prefix_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">incise</span><span class="o">.</span><span class="n">prefix_counts</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">scaled_suffix_talea_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">scaled_suffix_talea_counts</span><span class="p">)</span>
    <span class="n">suffix_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">incise</span><span class="o">.</span><span class="n">suffix_counts</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">scaled_extra_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">scaled_extra_counts</span><span class="p">)</span>
    <span class="n">duration_lists</span><span class="p">,</span> <span class="n">prefix_talea_index</span><span class="p">,</span> <span class="n">suffix_talea_index</span> <span class="o">=</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">prefix_count</span> <span class="o">=</span> <span class="n">prefix_counts_cycle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">suffix_count</span> <span class="o">=</span> <span class="n">suffix_counts_cycle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">prefix_talea_index</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">prefix_talea_index</span> <span class="o">+</span> <span class="n">prefix_count</span>
    <span class="n">prefix_talea_counts</span> <span class="o">=</span> <span class="n">scaled_prefix_talea_counts_cycle</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">suffix_talea_index</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">suffix_talea_index</span> <span class="o">+</span> <span class="n">suffix_count</span>
    <span class="n">suffix_talea_counts</span> <span class="o">=</span> <span class="n">scaled_suffix_talea_counts_cycle</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaled_pairs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">extra_count</span> <span class="o">=</span> <span class="n">scaled_extra_counts_cycle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">scaled_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">numerator</span> <span class="o">+=</span> <span class="n">extra_count</span> <span class="o">%</span> <span class="n">numerator</span>
        <span class="n">duration_list</span> <span class="o">=</span> <span class="n">_make_duration_list</span><span class="p">(</span>
            <span class="n">numerator</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">prefix_talea_counts</span><span class="p">),</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">suffix_talea_counts</span><span class="p">),</span>
            <span class="n">incise</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">duration_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration_list</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">extra_count</span> <span class="o">=</span> <span class="n">scaled_extra_counts_cycle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scaled_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">scaled_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">scaled_pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numerator</span>
        <span class="n">numerator</span> <span class="o">+=</span> <span class="n">extra_count</span> <span class="o">%</span> <span class="n">numerator</span>
        <span class="n">duration_list</span> <span class="o">=</span> <span class="n">_make_duration_list</span><span class="p">(</span>
            <span class="n">numerator</span><span class="p">,</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">prefix_talea_counts</span><span class="p">),</span>
            <span class="p">[],</span>
            <span class="n">incise</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">duration_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">scaled_pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scaled_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">extra_count</span> <span class="o">=</span> <span class="n">scaled_extra_counts_cycle</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">scaled_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">numerator</span> <span class="o">+=</span> <span class="n">extra_count</span> <span class="o">%</span> <span class="n">numerator</span>
            <span class="n">duration_list</span> <span class="o">=</span> <span class="n">_make_duration_list</span><span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">incise</span><span class="p">)</span>
            <span class="n">duration_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration_list</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">extra_count</span> <span class="o">=</span> <span class="n">scaled_extra_counts_cycle</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">UnboundLocalError</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="n">extra_count</span> <span class="o">=</span> <span class="n">scaled_extra_counts_cycle</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scaled_pairs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">scaled_pairs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">numerator</span> <span class="o">=</span> <span class="n">scaled_pairs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">numerator</span>
        <span class="n">numerator</span> <span class="o">+=</span> <span class="n">extra_count</span> <span class="o">%</span> <span class="n">numerator</span>
        <span class="n">duration_list</span> <span class="o">=</span> <span class="n">_make_duration_list</span><span class="p">(</span>
            <span class="n">numerator</span><span class="p">,</span>
            <span class="p">[],</span>
            <span class="nb">list</span><span class="p">(</span><span class="n">suffix_talea_counts</span><span class="p">),</span>
            <span class="n">incise</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">duration_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">duration_lists</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_prolated_pairs</span><span class="p">(</span>
    <span class="n">pairs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">extra_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
    <span class="n">extra_counts_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span>
    <span class="n">prolated_pairs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pairs</span><span class="p">):</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">extra_count</span> <span class="o">=</span> <span class="n">extra_counts_cycle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">extra_count</span><span class="p">:</span>
            <span class="n">extra_count</span> <span class="o">%=</span> <span class="n">numerator</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># NOTE: do not remove the following (nonfunctional) if-else;</span>
            <span class="c1">#       preserved for backwards compatability.</span>
            <span class="n">use_old_extra_counts_logic</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">use_old_extra_counts_logic</span><span class="p">:</span>
                <span class="n">extra_count</span> <span class="o">%=</span> <span class="n">numerator</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extra_count</span> <span class="o">%=</span> <span class="o">-</span><span class="n">numerator</span>
        <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">pair</span>
        <span class="n">prolated_pair</span> <span class="o">=</span> <span class="p">(</span><span class="n">numerator</span> <span class="o">+</span> <span class="n">extra_count</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
        <span class="n">prolated_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prolated_pair</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_pair_list</span><span class="p">(</span><span class="n">prolated_pairs</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">prolated_pairs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prolated_pairs</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_state_dictionary</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">durations_consumed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">logical_ties_produced</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">previous_durations_consumed</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">previous_incomplete_last_note</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">previous_logical_ties_produced</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">durations_consumed_</span> <span class="o">=</span> <span class="n">previous_durations_consumed</span> <span class="o">+</span> <span class="n">durations_consumed</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;durations_consumed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">durations_consumed_</span>
    <span class="n">logical_ties_produced_</span> <span class="o">=</span> <span class="n">previous_logical_ties_produced</span> <span class="o">+</span> <span class="n">logical_ties_produced</span>
    <span class="k">if</span> <span class="n">previous_incomplete_last_note</span><span class="p">:</span>
        <span class="n">logical_ties_produced_</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">state</span><span class="p">[</span><span class="s2">&quot;logical_ties_produced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logical_ties_produced_</span>
    <span class="n">state</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">state</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_talea_tuplets</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">extra_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">previous_state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">read_talea_once_only</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">spelling</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">talea</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Talea</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous_state</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">previous_state</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">read_talea_once_only</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">read_talea_once_only</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">talea</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Talea</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">talea</span><span class="p">)</span>
    <span class="n">talea_weight_consumed</span> <span class="o">=</span> <span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;talea_weight_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">talea_weight_consumed</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">talea_weight_consumed</span><span class="p">)</span>
    <span class="n">advanced_talea</span> <span class="o">=</span> <span class="n">talea</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">talea_weight_consumed</span><span class="p">)</span>
    <span class="n">durations_consumed</span> <span class="o">=</span> <span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;durations_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">durations_consumed</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations_consumed</span><span class="p">)</span>
    <span class="n">rotated_extra_counts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">,</span> <span class="o">-</span><span class="n">durations_consumed</span><span class="p">)</span>
    <span class="n">durations_</span> <span class="o">=</span> <span class="n">durations</span><span class="p">[:]</span>
    <span class="n">dummy_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">talea</span><span class="o">.</span><span class="n">denominator</span><span class="p">)</span>
    <span class="n">durations_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dummy_duration</span><span class="p">)</span>
    <span class="n">scaled_pairs</span> <span class="o">=</span> <span class="n">_durations_to_lcm_pairs</span><span class="p">(</span><span class="n">durations_</span><span class="p">)</span>
    <span class="n">dummy_pair</span> <span class="o">=</span> <span class="n">scaled_pairs</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">lcd</span> <span class="o">=</span> <span class="n">dummy_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">multiplier</span> <span class="o">=</span> <span class="n">lcd</span> <span class="o">/</span> <span class="n">talea</span><span class="o">.</span><span class="n">denominator</span>
    <span class="k">assert</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">is_integer_equivalent</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)</span>
    <span class="n">multiplier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)</span>
    <span class="n">scaled_end_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">advanced_talea</span><span class="o">.</span><span class="n">end_counts</span><span class="p">]</span>
    <span class="n">scaled_extra_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">rotated_extra_counts</span><span class="p">]</span>
    <span class="n">scaled_preamble_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">advanced_talea</span><span class="o">.</span><span class="n">preamble_counts</span><span class="p">]</span>
    <span class="n">scaled_talea_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">advanced_talea</span><span class="o">.</span><span class="n">counts</span><span class="p">]</span>
    <span class="n">numerator_lists</span><span class="p">,</span> <span class="n">expanded_talea</span> <span class="o">=</span> <span class="n">_make_talea_numerator_lists</span><span class="p">(</span>
        <span class="n">scaled_pairs</span><span class="p">,</span>
        <span class="n">scaled_preamble_counts</span><span class="p">,</span>
        <span class="n">scaled_talea_counts</span><span class="p">,</span>
        <span class="n">scaled_extra_counts</span><span class="p">,</span>
        <span class="n">scaled_end_counts</span><span class="p">,</span>
        <span class="n">read_talea_once_only</span><span class="o">=</span><span class="n">read_talea_once_only</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">unscaled_talea</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">expanded_talea</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">unscaled_talea</span> <span class="o">=</span> <span class="n">expanded_talea</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">advanced_talea</span><span class="o">.</span><span class="n">counts</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
            <span class="n">unscaled_talea</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
    <span class="n">talea_weight_consumed</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">numerator_lists</span><span class="p">)</span>
    <span class="n">component_lists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">numerator_list</span> <span class="ow">in</span> <span class="n">numerator_lists</span><span class="p">:</span>
        <span class="n">duration_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">lcd</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">numerator_list</span><span class="p">]</span>
        <span class="n">component_list</span> <span class="o">=</span> <span class="n">_make_components</span><span class="p">(</span>
            <span class="n">duration_list</span><span class="p">,</span>
            <span class="n">increase_monotonic</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">increase_monotonic</span><span class="p">,</span>
            <span class="n">forbidden_note_duration</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">forbidden_note_duration</span><span class="p">,</span>
            <span class="n">forbidden_rest_duration</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">forbidden_rest_duration</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">component_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scaled_extra_counts</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="n">tuplets</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">(</span><span class="s2">&quot;1:1&quot;</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">component_lists</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">durations_</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">durations</span><span class="p">(</span><span class="n">scaled_pairs</span><span class="p">)</span>
        <span class="n">tuplets</span> <span class="o">=</span> <span class="n">_package_tuplets</span><span class="p">(</span><span class="n">durations_</span><span class="p">,</span> <span class="n">component_lists</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">_apply_ties_to_split_notes</span><span class="p">(</span>
        <span class="n">tuplets</span><span class="p">,</span>
        <span class="n">advanced_talea</span><span class="o">.</span><span class="n">end_counts</span><span class="p">,</span>
        <span class="n">advanced_talea</span><span class="o">.</span><span class="n">preamble_counts</span><span class="p">,</span>
        <span class="n">unscaled_talea</span><span class="p">,</span>
        <span class="n">talea</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">abjad</span><span class="o">.</span><span class="n">iterate</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">tuplets</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">):</span>
        <span class="n">tuplet</span><span class="o">.</span><span class="n">normalize_ratio</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="n">advanced_talea</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Talea</span><span class="p">(</span>
        <span class="n">counts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">advanced_talea</span><span class="o">.</span><span class="n">counts</span><span class="p">),</span>
        <span class="n">denominator</span><span class="o">=</span><span class="n">talea</span><span class="o">.</span><span class="n">denominator</span><span class="p">,</span>
        <span class="n">end_counts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">advanced_talea</span><span class="o">.</span><span class="n">end_counts</span><span class="p">),</span>
        <span class="n">preamble_counts</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">advanced_talea</span><span class="o">.</span><span class="n">preamble_counts</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">advanced_talea</span><span class="o">.</span><span class="n">counts</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">advanced_talea</span><span class="o">.</span><span class="n">counts</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">talea_weight_consumed</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">advanced_talea</span><span class="p">:</span>
        <span class="n">last_leaf</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">leaf</span><span class="p">(</span><span class="n">tuplets</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">last_leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">):</span>
            <span class="n">state</span><span class="p">[</span><span class="s2">&quot;incomplete_last_note&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;talea_weight_consumed&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous_state</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">=</span> <span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">state</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">+=</span> <span class="n">talea_weight_consumed</span>
    <span class="k">return</span> <span class="n">tuplets</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_package_tuplets</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">component_lists</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">prototype</span> <span class="o">=</span> <span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">component_lists</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">prototype</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">item</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">tuplets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">duration</span><span class="p">,</span> <span class="n">component_list</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="n">component_lists</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">component_list</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Ratio</span><span class="p">(</span><span class="n">multiplier</span><span class="o">.</span><span class="n">denominator</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">.</span><span class="n">numerator</span><span class="p">)</span>
        <span class="n">tuplet</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span> <span class="n">component_list</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">tuplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tuplets</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_round_durations</span><span class="p">(</span>
    <span class="n">float_durations</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">]:</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">float_durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">float_durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">denominator</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">float_duration</span> <span class="ow">in</span> <span class="n">float_durations</span><span class="p">:</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">float_duration</span> <span class="o">*</span> <span class="n">denominator</span><span class="p">))</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
        <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">durations</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_split_talea_extended_to_weights</span><span class="p">(</span>
    <span class="n">preamble_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">prolated_numerators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">talea_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">read_talea_once_only</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">talea_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">talea_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">prolated_numerators</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">prolated_numerators</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">all_are_positive_integers</span><span class="p">(</span><span class="n">prolated_numerators</span><span class="p">)</span>
    <span class="n">preamble_weight</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">talea_weight</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">talea_counts</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">prolated_numerator_weight</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">weight</span><span class="p">(</span><span class="n">prolated_numerators</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">read_talea_once_only</span> <span class="ow">is</span> <span class="kc">True</span>
        <span class="ow">and</span> <span class="n">preamble_weight</span> <span class="o">+</span> <span class="n">talea_weight</span> <span class="o">&lt;</span> <span class="n">prolated_numerator_weight</span>
    <span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">preamble_counts</span><span class="si">!s}</span><span class="s2"> + </span><span class="si">{</span><span class="n">talea_counts</span><span class="si">!s}</span><span class="s2"> is too short&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; to read </span><span class="si">{</span><span class="n">prolated_numerators</span><span class="si">}</span><span class="s2"> once.&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prolated_numerator_weight</span> <span class="o">&lt;=</span> <span class="n">preamble_weight</span><span class="p">:</span>
        <span class="n">talea_counts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span>
            <span class="n">preamble_counts</span><span class="p">,</span>
            <span class="n">weight</span><span class="o">=</span><span class="n">prolated_numerator_weight</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prolated_numerator_weight</span> <span class="o">-=</span> <span class="n">preamble_weight</span>
        <span class="n">talea_counts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">repeat_to_weight</span><span class="p">(</span>
            <span class="n">talea_counts</span><span class="p">,</span>
            <span class="n">prolated_numerator_weight</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">talea_counts</span> <span class="o">=</span> <span class="n">preamble_counts</span> <span class="o">+</span> <span class="n">talea_counts</span>
    <span class="n">numerator_lists</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
        <span class="n">talea_counts</span><span class="p">,</span>
        <span class="n">prolated_numerators</span><span class="p">,</span>
        <span class="n">cyclic</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">numerator_lists</span>


<div class="viewcode-block" id="make_accelerandi">
<a class="viewcode-back" href="../../api/rmakers/makers.html#rmakers.makers.make_accelerandi">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_accelerandi</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">interpolations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">_classes</span><span class="o">.</span><span class="n">Interpolation</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">previous_state</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">spelling</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">(),</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes one accelerando (or ritardando) for each duration in ``durations``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs, interpolations):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_accelerandi(durations, interpolations)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.override_beam_grow_direction(leaf_lists)</span>
<span class="sd">        ...     rmakers.override_tuplet_number_text_duration_markup(tuplets)</span>
<span class="sd">        ...     rmakers.swap_length_1_tuplets_for_containers(tuplets)</span>
<span class="sd">        ...     score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">        ...     abjad.override(score).TupletBracket.padding = 2</span>
<span class="sd">        ...     abjad.override(score).TupletBracket.bracket_visibility = True</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Makes accelerandi:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 8), (3, 8), (4, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; durations = abjad.duration.durations([(1, 8), (1, 20), (1, 16)])</span>
<span class="sd">        &gt;&gt;&gt; interpolation = rmakers.Interpolation(*durations)</span>
<span class="sd">        &gt;&gt;&gt; interpolations = [interpolation]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, interpolations)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                \override TupletBracket.bracket-visibility = ##t</span>
<span class="sd">                \override TupletBracket.padding = 2</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 2 }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #right</span>
<span class="sd">                            c&#39;16 * 63/32</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 115/64</span>
<span class="sd">                            c&#39;16 * 91/64</span>
<span class="sd">                            c&#39;16 * 35/32</span>
<span class="sd">                            c&#39;16 * 29/32</span>
<span class="sd">                            c&#39;16 * 13/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 4. }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #right</span>
<span class="sd">                            c&#39;16 * 117/64</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 99/64</span>
<span class="sd">                            c&#39;16 * 69/64</span>
<span class="sd">                            c&#39;16 * 13/16</span>
<span class="sd">                            c&#39;16 * 47/64</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 2 }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #right</span>
<span class="sd">                            c&#39;16 * 63/32</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 115/64</span>
<span class="sd">                            c&#39;16 * 91/64</span>
<span class="sd">                            c&#39;16 * 35/32</span>
<span class="sd">                            c&#39;16 * 29/32</span>
<span class="sd">                            c&#39;16 * 13/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 4. }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #right</span>
<span class="sd">                            c&#39;16 * 117/64</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 99/64</span>
<span class="sd">                            c&#39;16 * 69/64</span>
<span class="sd">                            c&#39;16 * 13/16</span>
<span class="sd">                            c&#39;16 * 47/64</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Makes ritardandi:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 8), (3, 8), (4, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; durations = abjad.duration.durations([(1, 20), (1, 8), (1, 16)])</span>
<span class="sd">        &gt;&gt;&gt; interpolation = rmakers.Interpolation(*durations)</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, [interpolation])</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                \override TupletBracket.bracket-visibility = ##t</span>
<span class="sd">                \override TupletBracket.padding = 2</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 2 }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #left</span>
<span class="sd">                            c&#39;16 * 3/4</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 25/32</span>
<span class="sd">                            c&#39;16 * 7/8</span>
<span class="sd">                            c&#39;16 * 65/64</span>
<span class="sd">                            c&#39;16 * 79/64</span>
<span class="sd">                            c&#39;16 * 49/32</span>
<span class="sd">                            c&#39;16 * 29/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 4. }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #left</span>
<span class="sd">                            c&#39;16 * 5/8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 43/64</span>
<span class="sd">                            c&#39;16 * 51/64</span>
<span class="sd">                            c&#39;16 * 65/64</span>
<span class="sd">                            c&#39;16 * 85/64</span>
<span class="sd">                            c&#39;16 * 25/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 2 }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #left</span>
<span class="sd">                            c&#39;16 * 3/4</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 25/32</span>
<span class="sd">                            c&#39;16 * 7/8</span>
<span class="sd">                            c&#39;16 * 65/64</span>
<span class="sd">                            c&#39;16 * 79/64</span>
<span class="sd">                            c&#39;16 * 49/32</span>
<span class="sd">                            c&#39;16 * 29/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 4. }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #left</span>
<span class="sd">                            c&#39;16 * 5/8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 43/64</span>
<span class="sd">                            c&#39;16 * 51/64</span>
<span class="sd">                            c&#39;16 * 65/64</span>
<span class="sd">                            c&#39;16 * 85/64</span>
<span class="sd">                            c&#39;16 * 25/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Makes accelerandi and ritardandi, alternatingly:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 8), (3, 8), (4, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; duration_lists = [</span>
<span class="sd">        ...     abjad.duration.durations([(1, 8), (1, 20), (1, 16)]),</span>
<span class="sd">        ...     abjad.duration.durations([(1, 20), (1, 8), (1, 16)]),</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; interpolations = [rmakers.Interpolation(*_) for _ in duration_lists]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, interpolations)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                \override TupletBracket.bracket-visibility = ##t</span>
<span class="sd">                \override TupletBracket.padding = 2</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 2 }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #right</span>
<span class="sd">                            c&#39;16 * 63/32</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 115/64</span>
<span class="sd">                            c&#39;16 * 91/64</span>
<span class="sd">                            c&#39;16 * 35/32</span>
<span class="sd">                            c&#39;16 * 29/32</span>
<span class="sd">                            c&#39;16 * 13/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 4. }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #left</span>
<span class="sd">                            c&#39;16 * 5/8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 43/64</span>
<span class="sd">                            c&#39;16 * 51/64</span>
<span class="sd">                            c&#39;16 * 65/64</span>
<span class="sd">                            c&#39;16 * 85/64</span>
<span class="sd">                            c&#39;16 * 25/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 2 }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #right</span>
<span class="sd">                            c&#39;16 * 63/32</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 115/64</span>
<span class="sd">                            c&#39;16 * 91/64</span>
<span class="sd">                            c&#39;16 * 35/32</span>
<span class="sd">                            c&#39;16 * 29/32</span>
<span class="sd">                            c&#39;16 * 13/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 4. }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #left</span>
<span class="sd">                            c&#39;16 * 5/8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 43/64</span>
<span class="sd">                            c&#39;16 * 51/64</span>
<span class="sd">                            c&#39;16 * 65/64</span>
<span class="sd">                            c&#39;16 * 85/64</span>
<span class="sd">                            c&#39;16 * 25/16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Populates short duration with single note:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(5, 8), (3, 8), (1, 8)]</span>
<span class="sd">        &gt;&gt;&gt; durations = abjad.duration.durations([(1, 8), (1, 20), (1, 16)])</span>
<span class="sd">        &gt;&gt;&gt; interpolation = rmakers.Interpolation(*durations)</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, [interpolation])</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                \override TupletBracket.bracket-visibility = ##t</span>
<span class="sd">                \override TupletBracket.padding = 2</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) { \rhythm { 2 } + \rhythm { 8 } }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 5/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #right</span>
<span class="sd">                            c&#39;16 * 61/32</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 115/64</span>
<span class="sd">                            c&#39;16 * 49/32</span>
<span class="sd">                            c&#39;16 * 5/4</span>
<span class="sd">                            c&#39;16 * 33/32</span>
<span class="sd">                            c&#39;16 * 57/64</span>
<span class="sd">                            c&#39;16 * 13/16</span>
<span class="sd">                            c&#39;16 * 25/32</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        \override TupletNumber.text = \markup \scale #&#39;(0.75 . 0.75) \rhythm { 4. }</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            \once \override Beam.grow-direction = #right</span>
<span class="sd">                            c&#39;16 * 117/64</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16 * 99/64</span>
<span class="sd">                            c&#39;16 * 69/64</span>
<span class="sd">                            c&#39;16 * 13/16</span>
<span class="sd">                            c&#39;16 * 47/64</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \revert TupletNumber.text</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 1/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">()</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">interpolations</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">interpolations</span><span class="p">)</span>
    <span class="n">class_</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Interpolation</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">class_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">interpolations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">interpolations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spelling</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">spelling</span><span class="p">)</span>
    <span class="n">previous_state</span> <span class="o">=</span> <span class="n">previous_state</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">durations_consumed</span> <span class="o">=</span> <span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;durations_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">interpolations</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">interpolations</span><span class="p">,</span> <span class="n">n</span><span class="o">=-</span><span class="n">durations_consumed</span><span class="p">)</span>
    <span class="n">tuplets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">durations</span><span class="p">):</span>
        <span class="n">tuplet</span> <span class="o">=</span> <span class="n">_make_accelerando</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">interpolations</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">tuplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
    <span class="n">voice</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">logical_ties_produced</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">logical_ties</span><span class="p">(</span><span class="n">voice</span><span class="p">))</span>
    <span class="n">new_state</span> <span class="o">=</span> <span class="n">_make_state_dictionary</span><span class="p">(</span>
        <span class="n">durations_consumed</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
        <span class="n">logical_ties_produced</span><span class="o">=</span><span class="n">logical_ties_produced</span><span class="p">,</span>
        <span class="n">previous_durations_consumed</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;durations_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">previous_incomplete_last_note</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;incomplete_last_note&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">previous_logical_ties_produced</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logical_ties_produced&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">components</span><span class="p">,</span> <span class="n">tuplets</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">eject_contents</span><span class="p">(</span><span class="n">voice</span><span class="p">),</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="s2">&quot;FEATHER_BEAM_CONTAINER&quot;</span><span class="p">,</span> <span class="n">tuplet</span><span class="p">)</span>
        <span class="n">tuplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
    <span class="n">state</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tuplets</span></div>



<div class="viewcode-block" id="make_even_division_tuplets">
<a class="viewcode-back" href="../../api/rmakers/makers.html#rmakers.makers.make_even_division_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_even_division_tuplets</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">denominators</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">extra_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">previous_state</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">spelling</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">(),</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes one even-division tuplet for each duration in ``durations``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Basic example:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[0, 0, 1])</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.toggle_augmented_tuplets(tuplets)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(5, 16), (6, 16), (6, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 8/5</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 5/16</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        \time 6/16</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 4/3</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Understanding the ``denominators`` argument to ``rmakers.make_even_division_tuplets()``.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fills tuplets with 16th notes and 8th notes, alternately:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_even_division_tuplets(durations, [16, 8])</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 16), (3, 8), (3, 4)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fills tuplets with 8th notes:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_even_division_tuplets(durations, [8])</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 16), (3, 8), (3, 4)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/16</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            (Fills tuplets less than twice the duration of an eighth note with a single</span>
<span class="sd">            attack.)</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fills tuplets with quarter notes:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_even_division_tuplets(durations, [4])</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 16), (3, 8), (3, 4)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/16</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            (Fills tuplets less than twice the duration of a quarter note with a single</span>
<span class="sd">            attack.)</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Fills tuplets with half notes:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_even_division_tuplets(durations, [2])</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 16), (3, 8), (3, 4)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/16</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            \time 3/4</span>
<span class="sd">                            c&#39;2.</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            (Fills tuplets less than twice the duration of a half note with a single</span>
<span class="sd">            attack.)</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Using ``rmakers.make_even_division_tuplets()`` with the ``extra_counts`` keyword.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Adds extra counts to tuplets according to a pattern of three elements:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_even_division_tuplets(</span>
<span class="sd">            ...         durations, [16], extra_counts=[0, 1, 2]</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 8), (3, 8), (3, 8), (3, 8), (3, 8)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 7/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 8/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 7/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            **Modular handling of positive values.** Denote by ``unprolated_note_count``</span>
<span class="sd">            the number counts included in a tuplet when ``extra_counts`` is set to zero.</span>
<span class="sd">            Then extra counts equals ``extra_counts % unprolated_note_count`` when</span>
<span class="sd">            ``extra_counts`` is positive.</span>

<span class="sd">            This is likely to be intuitive; compare with the handling of negative values,</span>
<span class="sd">            below.</span>

<span class="sd">            For positive extra counts, the modulus of transformation of a tuplet with six</span>
<span class="sd">            notes is six:</span>

<span class="sd">            &gt;&gt;&gt; import math</span>
<span class="sd">            &gt;&gt;&gt; unprolated_note_count = 6</span>
<span class="sd">            &gt;&gt;&gt; modulus = unprolated_note_count</span>
<span class="sd">            &gt;&gt;&gt; extra_counts = list(range(12))</span>
<span class="sd">            &gt;&gt;&gt; labels = []</span>
<span class="sd">            &gt;&gt;&gt; for count in extra_counts:</span>
<span class="sd">            ...     modular_count = count % modulus</span>
<span class="sd">            ...     label = rf&quot;\markup {{ {count:3} becomes {modular_count:2} }}&quot;</span>
<span class="sd">            ...     labels.append(label)</span>

<span class="sd">            Which produces the following pattern of changes:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs, extra_counts):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_even_division_tuplets(</span>
<span class="sd">            ...         durations, [16], extra_counts=extra_counts</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = 12 * [(6, 16)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, extra_counts)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[&quot;Staff&quot;]</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TextScript.staff_padding = 7</span>
<span class="sd">            &gt;&gt;&gt; leaves = abjad.select.leaves(staff)</span>
<span class="sd">            &gt;&gt;&gt; groups = abjad.select.group_by_measure(leaves)</span>
<span class="sd">            &gt;&gt;&gt; for group, label in zip(groups, labels, strict=True):</span>
<span class="sd">            ...     markup = abjad.Markup(label)</span>
<span class="sd">            ...     abjad.attach(markup, group[0], direction=abjad.UP)</span>
<span class="sd">            ...</span>

<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                        \override TextScript.staff-padding = 7</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ^ \markup {   0 becomes  0 }</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 7/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {   1 becomes  1 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 8/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {   2 becomes  2 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 9/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {   3 becomes  3 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 10/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {   4 becomes  4 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 11/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {   5 becomes  5 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ^ \markup {   6 becomes  0 }</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 7/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {   7 becomes  1 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 8/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {   8 becomes  2 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 9/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {   9 becomes  3 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 10/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {  10 becomes  4 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 11/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {  11 becomes  5 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            This modular formula ensures that rhythm-maker ``denominators`` are always</span>
<span class="sd">            respected: a very large number of extra counts never causes a</span>
<span class="sd">            ``16``-denominated tuplet to result in 32nd- or 64th-note rhythms.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            **Modular handling of negative values.** Denote by ``unprolated_note_count``</span>
<span class="sd">            the number of counts included in a tuplet when ``extra_counts`` is set to</span>
<span class="sd">            zero. Further, let ``modulus = ceiling(unprolated_note_count / 2)``. Then</span>
<span class="sd">            extra counts equals ``-(abs(extra_counts) % modulus)`` when ``extra_counts``</span>
<span class="sd">            is negative.</span>

<span class="sd">            For negative extra counts, the modulus of transformation of a tuplet with six</span>
<span class="sd">            notes is three:</span>

<span class="sd">            &gt;&gt;&gt; import math</span>
<span class="sd">            &gt;&gt;&gt; unprolated_note_count = 6</span>
<span class="sd">            &gt;&gt;&gt; modulus = math.ceil(unprolated_note_count / 2)</span>
<span class="sd">            &gt;&gt;&gt; extra_counts = [0, -1, -2, -3, -4, -5, -6, -7, -8]</span>
<span class="sd">            &gt;&gt;&gt; labels = []</span>
<span class="sd">            &gt;&gt;&gt; for count in extra_counts:</span>
<span class="sd">            ...     modular_count = -(abs(count) % modulus)</span>
<span class="sd">            ...     label = rf&quot;\markup {{ {count:3} becomes {modular_count:2} }}&quot;</span>
<span class="sd">            ...     labels.append(label)</span>

<span class="sd">            Which produces the following pattern of changes:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs, extra_counts):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_even_division_tuplets(</span>
<span class="sd">            ...         durations, [16], extra_counts=extra_counts</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = 9 * [(6, 16)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, extra_counts)</span>
<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[&quot;Staff&quot;]</span>
<span class="sd">            &gt;&gt;&gt; abjad.override(staff).TextScript.staff_padding = 8</span>
<span class="sd">            &gt;&gt;&gt; leaves = abjad.select.leaves(staff)</span>
<span class="sd">            &gt;&gt;&gt; groups = abjad.select.group_by_measure(leaves)</span>
<span class="sd">            &gt;&gt;&gt; for group, label in zip(groups, labels, strict=True):</span>
<span class="sd">            ...     markup = abjad.Markup(label)</span>
<span class="sd">            ...     abjad.attach(markup, group[0], direction=abjad.UP)</span>
<span class="sd">            ...</span>

<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                        \override TextScript.staff-padding = 8</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 6/16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ^ \markup {   0 becomes  0 }</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 5/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {  -1 becomes -1 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 4/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {  -2 becomes -2 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ^ \markup {  -3 becomes  0 }</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 5/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {  -4 becomes -1 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 4/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {  -5 becomes -2 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ^ \markup {  -6 becomes  0 }</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 5/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {  -7 becomes -1 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 4/6</span>
<span class="sd">                            {</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ^ \markup {  -8 becomes -2 }</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">            This modular formula ensures that rhythm-maker ``denominators`` are</span>
<span class="sd">            always respected: a very small number of extra counts never causes</span>
<span class="sd">            a ``16``-denominated tuplet to result in 8th- or quarter-note</span>
<span class="sd">            rhythms.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">()</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">denominators</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">denominators</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">extra_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">extra_counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span>
    <span class="n">previous_state</span> <span class="o">=</span> <span class="n">previous_state</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">tuplets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous_state</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="n">durations_consumed</span> <span class="o">=</span> <span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;durations_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">denominators_</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">denominators</span><span class="p">)</span>
    <span class="n">denominators_</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">denominators_</span><span class="p">,</span> <span class="o">-</span><span class="n">durations_consumed</span><span class="p">)</span>
    <span class="n">cyclic_denominators</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">denominators_</span><span class="p">)</span>
    <span class="n">extra_counts_</span> <span class="o">=</span> <span class="n">extra_counts</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">extra_counts__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">extra_counts_</span><span class="p">)</span>
    <span class="n">extra_counts__</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">extra_counts__</span><span class="p">,</span> <span class="o">-</span><span class="n">durations_consumed</span><span class="p">)</span>
    <span class="n">cyclic_extra_counts</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">extra_counts__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">durations</span><span class="p">):</span>
        <span class="n">tuplet_duration</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">is_positive_integer_power_of_two</span><span class="p">(</span><span class="n">tuplet_duration</span><span class="o">.</span><span class="n">denominator</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nondyadic durations not implemented: </span><span class="si">{</span><span class="n">tuplet_duration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">denominator_</span> <span class="o">=</span> <span class="n">cyclic_denominators</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">extra_count</span> <span class="o">=</span> <span class="n">cyclic_extra_counts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">note_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">denominator_</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">note_duration</span><span class="o">.</span><span class="n">is_dyadic</span><span class="p">()</span>
        <span class="n">unprolated_note_count</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">pitches</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_pitches</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">tuplet_duration</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">note_duration</span><span class="p">:</span>
            <span class="n">note_durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">tuplet_duration</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unprolated_note_count_fraction</span> <span class="o">=</span> <span class="n">tuplet_duration</span> <span class="o">/</span> <span class="n">note_duration</span>
            <span class="n">unprolated_note_count</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">unprolated_note_count_fraction</span><span class="p">)</span>
            <span class="n">unprolated_note_count</span> <span class="o">=</span> <span class="n">unprolated_note_count</span> <span class="ow">or</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">extra_count</span><span class="p">:</span>
                <span class="n">modulus</span> <span class="o">=</span> <span class="n">unprolated_note_count</span>
                <span class="n">extra_count</span> <span class="o">=</span> <span class="n">extra_count</span> <span class="o">%</span> <span class="n">modulus</span>
            <span class="k">elif</span> <span class="n">extra_count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">modulus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">unprolated_note_count</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">))</span>
                <span class="n">extra_count</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">extra_count</span><span class="p">)</span> <span class="o">%</span> <span class="n">modulus</span>
                <span class="n">extra_count</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">note_count</span> <span class="o">=</span> <span class="n">unprolated_note_count</span> <span class="o">+</span> <span class="n">extra_count</span>
            <span class="n">note_durations</span> <span class="o">=</span> <span class="n">note_count</span> <span class="o">*</span> <span class="p">[</span><span class="n">note_duration</span><span class="p">]</span>
        <span class="n">notes</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_notes</span><span class="p">(</span><span class="n">pitches</span><span class="p">,</span> <span class="n">note_durations</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="n">tuplet_duration</span> <span class="o">/</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">notes</span><span class="p">)</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Ratio</span><span class="p">(</span><span class="n">multiplier</span><span class="o">.</span><span class="n">denominator</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">.</span><span class="n">numerator</span><span class="p">)</span>
        <span class="n">tuplet</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">(</span><span class="n">ratio</span><span class="p">,</span> <span class="n">notes</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unprolated_note_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">multiplier_numerator</span> <span class="o">=</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span><span class="o">.</span><span class="n">denominator</span>
            <span class="n">multiplier_denominator</span> <span class="o">=</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span><span class="o">.</span><span class="n">numerator</span>
            <span class="k">if</span> <span class="n">multiplier_denominator</span> <span class="o">&lt;</span> <span class="n">note_count</span><span class="p">:</span>
                <span class="n">scalar</span> <span class="o">=</span> <span class="n">note_count</span> <span class="o">/</span> <span class="n">multiplier_denominator</span>
                <span class="k">assert</span> <span class="n">scalar</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
                <span class="n">scalar</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">scalar</span><span class="p">)</span>
                <span class="n">multiplier_denominator</span> <span class="o">*=</span> <span class="n">scalar</span>
                <span class="n">multiplier_numerator</span> <span class="o">*=</span> <span class="n">scalar</span>
                <span class="n">ratio_</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Ratio</span><span class="p">(</span><span class="n">multiplier_denominator</span><span class="p">,</span> <span class="n">multiplier_numerator</span><span class="p">)</span>
                <span class="n">tuplet</span><span class="o">.</span><span class="n">set_ratio</span><span class="p">(</span><span class="n">ratio_</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span><span class="o">.</span><span class="n">numerator</span> <span class="o">==</span> <span class="n">note_count</span>
        <span class="n">tuplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">voice</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">logical_ties_produced</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">logical_ties</span><span class="p">(</span><span class="n">voice</span><span class="p">))</span>
    <span class="n">new_state</span> <span class="o">=</span> <span class="n">_make_state_dictionary</span><span class="p">(</span>
        <span class="n">durations_consumed</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
        <span class="n">logical_ties_produced</span><span class="o">=</span><span class="n">logical_ties_produced</span><span class="p">,</span>
        <span class="n">previous_durations_consumed</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;durations_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">previous_incomplete_last_note</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;incomplete_last_note&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">previous_logical_ties_produced</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logical_ties_produced&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">components</span><span class="p">,</span> <span class="n">tuplets</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">eject_contents</span><span class="p">(</span><span class="n">voice</span><span class="p">),</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span>
        <span class="n">tuplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
    <span class="n">state</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tuplets</span></div>



<div class="viewcode-block" id="make_incised_tuplets">
<a class="viewcode-back" href="../../api/rmakers/makers.html#rmakers.makers.make_incised_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_incised_tuplets</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">talea_denominator</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">body_proportion</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
    <span class="n">extra_counts</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">fill_with_rests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">outer_tuplets_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">prefix_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">prefix_talea</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">spelling</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">(),</span>
    <span class="n">suffix_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">suffix_talea</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes one incised tuplet for each duration in  ``durations``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Set ``prefix_talea=[-1]`` with ``prefix_counts=[1]`` to incise a rest</span>
<span class="sd">        at the start of each tuplet:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_incised_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         talea_denominator=16,</span>
<span class="sd">        ...         prefix_talea=[-1],</span>
<span class="sd">        ...         prefix_counts=[1],</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = 4 * [(5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/16</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    Set ``prefix_talea=[-1]`` with ``prefix_counts=[2]`` to incise 2 rests at the start</span>
<span class="sd">    of each tuplet:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_incised_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         talea_denominator=16,</span>
<span class="sd">        ...         prefix_talea=[-1],</span>
<span class="sd">        ...         prefix_counts=[2],</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = 4 * [(5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/16</span>
<span class="sd">                        r16</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        r16</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        r16</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        r16</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    Set ``prefix_talea=[1]`` with ``prefix_counts=[1]`` to incise 1 note at the start</span>
<span class="sd">    of each tuplet:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_incised_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         talea_denominator=16,</span>
<span class="sd">        ...         prefix_talea=[1],</span>
<span class="sd">        ...         prefix_counts=[1],</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = 4 * [(5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    Set ``prefix_talea=[1]`` with ``prefix_counts=[2]`` to incise 2 notes at the start</span>
<span class="sd">    of each tuplet:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_incised_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         talea_denominator=16,</span>
<span class="sd">        ...         prefix_talea=[1],</span>
<span class="sd">        ...         prefix_counts=[2],</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = 4 * [(5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/16</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    Incise rests at the beginning and end of each tuplet like this:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_incised_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         talea_denominator=16,</span>
<span class="sd">        ...         extra_counts=[1],</span>
<span class="sd">        ...         prefix_talea=[-1],</span>
<span class="sd">        ...         prefix_counts=[1],</span>
<span class="sd">        ...         suffix_talea=[-1],</span>
<span class="sd">        ...         suffix_counts=[1],</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = 4 * [(5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 6/5</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 5/16</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 6/5</span>
<span class="sd">                        {</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 6/5</span>
<span class="sd">                        {</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 6/5</span>
<span class="sd">                        {</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    Set ``body_proportion=(1, 1)`` to divide the middle part of each tuplet ``1:1``:</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_incised_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         talea_denominator=16,</span>
<span class="sd">        ...         body_proportion=(1, 1),</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = 4 * [(5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 5/16</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        ]</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        ]</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        ]</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;32</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Set ``body_proportion=(1, 1, 1)`` to divide the middle part of each</span>
<span class="sd">        tuplet ``1:1:1``:</span>

<span class="sd">        TODO. Allow nested tuplets to clean up notation:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_incised_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         talea_denominator=16,</span>
<span class="sd">        ...         body_proportion=(1, 1, 1),</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     abjad.makers.tweak_tuplet_bracket_edge_height(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [abjad.select.leaves(_) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = 4 * [(5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 5/16</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak edge-height #&#39;(0.7 . 0)</span>
<span class="sd">                        \tuplet 48/32</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">()</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">talea_denominator</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">talea_denominator</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">extra_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">extra_counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span>
    <span class="n">incise</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Incise</span><span class="p">(</span>
        <span class="n">talea_denominator</span><span class="p">,</span>
        <span class="n">body_proportion</span><span class="o">=</span><span class="n">body_proportion</span><span class="p">,</span>
        <span class="n">fill_with_rests</span><span class="o">=</span><span class="n">fill_with_rests</span><span class="p">,</span>
        <span class="n">outer_tuplets_only</span><span class="o">=</span><span class="n">outer_tuplets_only</span><span class="p">,</span>
        <span class="n">prefix_talea</span><span class="o">=</span><span class="n">prefix_talea</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="n">prefix_counts</span><span class="o">=</span><span class="n">prefix_counts</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="n">suffix_talea</span><span class="o">=</span><span class="n">suffix_talea</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="n">suffix_counts</span><span class="o">=</span><span class="n">suffix_counts</span> <span class="ow">or</span> <span class="p">[],</span>
    <span class="p">)</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">incise</span><span class="o">.</span><span class="n">talea_denominator</span><span class="p">)</span>
    <span class="n">scaled_pairs</span> <span class="o">=</span> <span class="n">_durations_to_lcm_pairs</span><span class="p">(</span><span class="n">durations</span> <span class="o">+</span> <span class="p">[</span><span class="n">duration</span><span class="p">])</span>
    <span class="n">lcm</span> <span class="o">=</span> <span class="n">scaled_pairs</span><span class="o">.</span><span class="n">pop</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">multiplier</span> <span class="o">=</span> <span class="n">lcm</span> <span class="o">/</span> <span class="n">incise</span><span class="o">.</span><span class="n">talea_denominator</span>
    <span class="k">assert</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">is_integer_equivalent</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)</span>
    <span class="n">multiplier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)</span>
    <span class="n">scaled_prefix_talea_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">incise</span><span class="o">.</span><span class="n">prefix_talea</span><span class="p">]</span>
    <span class="n">scaled_suffix_talea_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">incise</span><span class="o">.</span><span class="n">suffix_talea</span><span class="p">]</span>
    <span class="n">scaled_extra_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">multiplier</span> <span class="o">*</span> <span class="n">_</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">extra_counts</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">incise</span><span class="o">.</span><span class="n">outer_tuplets_only</span><span class="p">:</span>
        <span class="n">duration_lists</span> <span class="o">=</span> <span class="n">_make_outer_tuplets_only_incised_duration_lists</span><span class="p">(</span>
            <span class="n">scaled_pairs</span><span class="p">,</span>
            <span class="n">scaled_prefix_talea_counts</span><span class="p">,</span>
            <span class="n">scaled_suffix_talea_counts</span><span class="p">,</span>
            <span class="n">scaled_extra_counts</span><span class="p">,</span>
            <span class="n">incise</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">duration_lists</span> <span class="o">=</span> <span class="n">_make_incised_duration_lists</span><span class="p">(</span>
            <span class="n">scaled_pairs</span><span class="p">,</span>
            <span class="n">scaled_prefix_talea_counts</span><span class="p">,</span>
            <span class="n">incise</span><span class="o">.</span><span class="n">prefix_counts</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">scaled_suffix_talea_counts</span><span class="p">,</span>
            <span class="n">incise</span><span class="o">.</span><span class="n">suffix_counts</span> <span class="ow">or</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">scaled_extra_counts</span><span class="p">,</span>
            <span class="n">incise</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">component_lists</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">duration_list</span> <span class="ow">in</span> <span class="n">duration_lists</span><span class="p">:</span>
        <span class="n">duration_list_</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">duration</span> <span class="ow">in</span> <span class="n">duration_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">duration</span> <span class="o">==</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="n">duration</span><span class="o">.</span><span class="n">as_fraction</span><span class="p">()</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="n">fraction</span><span class="p">,</span> <span class="n">lcm</span><span class="p">)</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="n">fraction</span><span class="o">.</span><span class="n">as_integer_ratio</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="o">*</span><span class="n">pair</span><span class="p">)</span>
            <span class="n">duration_list_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">_make_components</span><span class="p">(</span>
            <span class="n">duration_list_</span><span class="p">,</span>
            <span class="n">forbidden_note_duration</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">forbidden_note_duration</span><span class="p">,</span>
            <span class="n">forbidden_rest_duration</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">forbidden_rest_duration</span><span class="p">,</span>
            <span class="n">increase_monotonic</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">increase_monotonic</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">component_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">durations</span><span class="p">(</span><span class="n">scaled_pairs</span><span class="p">)</span>
    <span class="n">tuplets</span> <span class="o">=</span> <span class="n">_package_tuplets</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="n">component_lists</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tuplets</span></div>



<div class="viewcode-block" id="make_notes_with_dmps">
<a class="viewcode-back" href="../../api/rmakers/makers.html#rmakers.makers.make_notes_with_dmps">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_notes_with_dmps</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">written_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes one note with ``written_duration`` and duration multiplier for each</span>
<span class="sd">    duration in ``durations``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(durations, written_duration):</span>
<span class="sd">        ...     components = rmakers.make_notes_with_dmps(durations, written_duration)</span>
<span class="sd">        ...     integer_ratios = [_.as_integer_ratio() for _ in durations]</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(integer_ratios)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Makes whole notes with duration multipliers:</span>

<span class="sd">        &gt;&gt;&gt; durations = abjad.duration.durations([(1, 4), (3, 16), (5, 8), (1, 3)])</span>
<span class="sd">        &gt;&gt;&gt; written_duration = abjad.Duration(1)</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(durations, written_duration)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 1/4</span>
<span class="sd">                        c&#39;1 * 1/4</span>
<span class="sd">                        \time 3/16</span>
<span class="sd">                        c&#39;1 * 3/16</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        c&#39;1 * 5/8</span>
<span class="sd">                        #(ly:expect-warning &quot;strange time signature found&quot;)</span>
<span class="sd">                        \time 1/3</span>
<span class="sd">                        c&#39;1 * 1/3</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Makes half notes with duration multipliers:</span>

<span class="sd">        &gt;&gt;&gt; written_duration = abjad.Duration(1, 2)</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(durations, written_duration)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 1/4</span>
<span class="sd">                        c&#39;2 * 2/4</span>
<span class="sd">                        \time 3/16</span>
<span class="sd">                        c&#39;2 * 6/16</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        c&#39;2 * 10/8</span>
<span class="sd">                        #(ly:expect-warning &quot;strange time signature found&quot;)</span>
<span class="sd">                        \time 1/3</span>
<span class="sd">                        c&#39;2 * 2/3</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Makes quarter notes with duration multipliers:</span>

<span class="sd">        &gt;&gt;&gt; written_duration = abjad.Duration(1, 4)</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(durations, written_duration)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 1/4</span>
<span class="sd">                        c&#39;4 * 4/4</span>
<span class="sd">                        \time 3/16</span>
<span class="sd">                        c&#39;4 * 12/16</span>
<span class="sd">                        \time 5/8</span>
<span class="sd">                        c&#39;4 * 20/8</span>
<span class="sd">                        #(ly:expect-warning &quot;strange time signature found&quot;)</span>
<span class="sd">                        \time 1/3</span>
<span class="sd">                        c&#39;4 * 4/3</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">()</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">written_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">written_duration</span><span class="p">)</span>
    <span class="n">notes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">NamedPitch</span><span class="p">(</span><span class="s2">&quot;c&#39;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">duration</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">:</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="n">duration</span> <span class="o">/</span> <span class="n">written_duration</span>
        <span class="n">denominators</span> <span class="o">=</span> <span class="p">[</span><span class="n">duration</span><span class="o">.</span><span class="n">denominator</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">.</span><span class="n">denominator</span><span class="p">]</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">least_common_multiple</span><span class="p">(</span><span class="o">*</span><span class="n">denominators</span><span class="p">)</span>
        <span class="n">dmp</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">pair_with_denominator</span><span class="p">(</span><span class="n">multiplier</span><span class="p">,</span> <span class="n">denominator</span><span class="p">)</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">from_duration_and_pitch</span><span class="p">(</span>
            <span class="n">written_duration</span><span class="p">,</span>
            <span class="n">pitch</span><span class="p">,</span>
            <span class="n">dmp</span><span class="o">=</span><span class="n">dmp</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">notes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">notes</span></div>



<div class="viewcode-block" id="make_notes">
<a class="viewcode-back" href="../../api/rmakers/makers.html#rmakers.makers.make_notes">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_notes</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">spelling</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">(),</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes one or more notes (or tuplets) for every duration in ``durations``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     notes = rmakers.make_notes(durations)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         notes, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 8), (3, 8), (4, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">()</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">durations</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spelling</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">spelling</span><span class="p">)</span>
    <span class="n">components</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">duration</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">:</span>
        <span class="n">components_</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_leaves</span><span class="p">(</span>
            <span class="p">[[</span><span class="n">abjad</span><span class="o">.</span><span class="n">NamedPitch</span><span class="p">(</span><span class="s2">&quot;c&#39;&quot;</span><span class="p">)]],</span>
            <span class="p">[</span><span class="n">duration</span><span class="p">],</span>
            <span class="n">increase_monotonic</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">increase_monotonic</span><span class="p">,</span>
            <span class="n">forbidden_note_duration</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">forbidden_note_duration</span><span class="p">,</span>
            <span class="n">forbidden_rest_duration</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">forbidden_rest_duration</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">components</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">components_</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_leaf_or_tuplet_list</span><span class="p">(</span><span class="n">components</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">components</span></div>



<div class="viewcode-block" id="make_talea_tuplets">
<a class="viewcode-back" href="../../api/rmakers/makers.html#rmakers.makers.make_talea_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_talea_tuplets</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">advance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">end_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">extra_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">preamble_counts</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">previous_state</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">read_talea_once_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">spelling</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">(),</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads ``counts`` cyclically and makes one tuplet for each duration in</span>
<span class="sd">    ``durations``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Repeats talea of 1/16, 2/16, 3/16, 4/16:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1, 2, 3, 4], 16)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Using ``rmakers.make_talea_tuplets()`` with the ``extra_counts`` keyword.</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs, extra_counts):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         [1, 2, 3, 4],</span>
<span class="sd">        ...         16,</span>
<span class="sd">        ...         extra_counts=extra_counts,</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.swap_trivial_tuplets_for_containers(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            **#1.** Set ``extra_counts=[0, 1]`` to add one extra count to every</span>
<span class="sd">            other tuplet:</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, extra_counts=[0, 1])</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 3/8</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tuplet 9/8</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 4/8</span>
<span class="sd">                                c&#39;4</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                ]</span>
<span class="sd">                                ~</span>
<span class="sd">                            }</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 3/8</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;4</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                            }</span>
<span class="sd">                            \tuplet 9/8</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 4/8</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                ]</span>
<span class="sd">                                c&#39;4</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            **#2.** Set ``extra_counts=[0, 2]`` to add two extra counts to</span>
<span class="sd">            every other tuplet:</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, extra_counts=[0, 2])</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 3/8</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tuplet 5/4</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 4/8</span>
<span class="sd">                                c&#39;4</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 3/8</span>
<span class="sd">                                c&#39;4</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                                ~</span>
<span class="sd">                            }</span>
<span class="sd">                            \tuplet 5/4</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 4/8</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                ]</span>
<span class="sd">                                c&#39;4</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            **#3.** Set ``extra_counts=[0, -1]`` to remove one count from every</span>
<span class="sd">            other tuplet:</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, extra_counts=[0, -1])</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 3/8</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 7/8</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 4/8</span>
<span class="sd">                                c&#39;4</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 3/8</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                ]</span>
<span class="sd">                                ~</span>
<span class="sd">                            }</span>
<span class="sd">                            \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                            \tuplet 7/8</span>
<span class="sd">                            {</span>
<span class="sd">                                \time 4/8</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                [</span>
<span class="sd">                                c&#39;16</span>
<span class="sd">                                c&#39;8</span>
<span class="sd">                                c&#39;8.</span>
<span class="sd">                                ]</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        **Reading talea once only.** Set ``read_talea_once_only=True`` to raise</span>
<span class="sd">        an exception if input durations exceed that of a single reading of</span>
<span class="sd">        talea. The effect is to ensure that a talea is long enough to cover all</span>
<span class="sd">        durations without repeating. Useful when, for example, interpolating</span>
<span class="sd">        from short durations to long durations.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Using ``rmakers.make_talea_tuplets()`` with the ``preamble_counts`` keyword.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            Preamble less than total duration:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">            ...         durations, [8, -4, 8], 32, preamble_counts=[1, 1, 1, 1]</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            ]</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            r8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            r8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r8</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">        .. container:: example</span>

<span class="sd">            Preamble more than total duration; ignores counts:</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">            ...         durations, [8, -4, 8], 32, preamble_counts=[32, 32, 32, 32]</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     container = abjad.Container(tuplets)</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         components, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            ~</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                            ~</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;2</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Using ``rmakers.make_talea_tuplets()`` with the ``end_counts`` keyword.</span>

<span class="sd">        ..  container:: example</span>

<span class="sd">            &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">            ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">            ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">            ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">            ...         durations, [8, -4, 8], 32, end_counts=[1, 1, 1, 1]</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">            ...         tuplets, time_signatures</span>
<span class="sd">            ...     )</span>
<span class="sd">            ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">            ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">            ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">            ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">            ...     return lilypond_file</span>

<span class="sd">            &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">            &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">            &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">            ..  docs::</span>

<span class="sd">                &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">                &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">                &gt;&gt;&gt; print(string)</span>
<span class="sd">                \context Score = &quot;Score&quot;</span>
<span class="sd">                {</span>
<span class="sd">                    \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                    \with</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Clef.stencil = ##f</span>
<span class="sd">                    }</span>
<span class="sd">                    {</span>
<span class="sd">                        \context Voice = &quot;Voice&quot;</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r8</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            r8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r8</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            c&#39;32</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_or_string_list</span><span class="p">(</span><span class="n">counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">denominator</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">advance</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">advance</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">end_counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">extra_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">extra_counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">extra_counts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">preamble_counts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">preamble_counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">assert</span> <span class="n">_is_integer_list</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">preamble_counts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">previous_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">previous_state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">previous_state</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">read_talea_once_only</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">read_talea_once_only</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spelling</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">spelling</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">state</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="n">talea</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Talea</span><span class="p">(</span>
        <span class="n">counts</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span>
        <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">,</span>
        <span class="n">end_counts</span><span class="o">=</span><span class="n">end_counts</span><span class="p">,</span>
        <span class="n">preamble_counts</span><span class="o">=</span><span class="n">preamble_counts</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">talea</span> <span class="o">=</span> <span class="n">talea</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">advance</span><span class="p">)</span>
    <span class="n">tuplets</span> <span class="o">=</span> <span class="n">_make_talea_tuplets</span><span class="p">(</span>
        <span class="n">durations</span><span class="p">,</span>
        <span class="n">extra_counts</span><span class="p">,</span>
        <span class="n">previous_state</span><span class="p">,</span>
        <span class="n">read_talea_once_only</span><span class="p">,</span>
        <span class="n">spelling</span><span class="p">,</span>
        <span class="n">state</span><span class="p">,</span>
        <span class="n">talea</span><span class="p">,</span>
        <span class="n">tag</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">voice</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">logical_ties_produced</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">logical_ties</span><span class="p">(</span><span class="n">voice</span><span class="p">))</span>
    <span class="n">new_state</span> <span class="o">=</span> <span class="n">_make_state_dictionary</span><span class="p">(</span>
        <span class="n">durations_consumed</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
        <span class="n">logical_ties_produced</span><span class="o">=</span><span class="n">logical_ties_produced</span><span class="p">,</span>
        <span class="n">previous_durations_consumed</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;durations_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">previous_incomplete_last_note</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;incomplete_last_note&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">previous_logical_ties_produced</span><span class="o">=</span><span class="n">previous_state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logical_ties_produced&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">eject_contents</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">state</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_state</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tuplets</span></div>



<div class="viewcode-block" id="make_tuplets">
<a class="viewcode-back" href="../../api/rmakers/makers.html#rmakers.makers.make_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">make_tuplets</span><span class="p">(</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
    <span class="n">proportions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">]:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads ``proportions`` cyclically and makes one tuplet for each duration in</span>
<span class="sd">    ``durations``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs, proportions):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_tuplets(durations, proportions)</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        Makes tuplets with ``3:2`` ratios:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(1, 2), (3, 8), (5, 16), (5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; proportions = [(3, 2)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, proportions)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 5/4</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 1/2</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 5/3</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 5/16</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Makes tuplets with alternating ``1:-1`` and ``3:1`` ratios:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(1, 2), (3, 8), (5, 16), (5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; proportions = [(1, -1), (3, 1)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, proportions)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 1/2</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r4</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 4/3</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 8/5</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 5/16</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            r4</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 8/5</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span> <span class="ow">or</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">()</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_integer_tuple_list</span><span class="p">(</span><span class="n">proportions</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">proportions</span><span class="p">)</span>
    <span class="n">tuplets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">proportions_cycle</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">CyclicTuple</span><span class="p">(</span><span class="n">proportions</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">duration</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">durations</span><span class="p">):</span>
        <span class="n">proportion</span> <span class="o">=</span> <span class="n">proportions_cycle</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">tuplet</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_tuplet</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">proportion</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">tuplet</span><span class="o">.</span><span class="n">normalize_ratio</span><span class="p">()</span>
        <span class="n">tuplets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tuplets</span></div>

</pre></div>

    </div>
    
    </div>
    

<footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2008-2025, Trevor Baa.
      <span class="lastupdated">
        Last updated on Oct 31, 2025.
      </span>

    </p>
  </div> 

</footer>

</div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>