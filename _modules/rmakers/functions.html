

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>rmakers.functions &mdash; rmakers  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/abjad.css?v=582143d1" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../_static/uqbar.css?v=e6773f5c" />

  
    <link rel="canonical" href="https://abjad.github.io/rmakers_modules/rmakers/functions.html"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/ga.js"></script>
      <script src="../../_static/toggleprompt.js?v=5801b3bb"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #BB2299" >


    <a href="../../index.html" class="icon icon-home" alt="Documentation
    Home"> rmakers 3.31



</a>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">rmakers API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #BB2299" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">rmakers</a>
      </nav>

      <div class="wy-nav-content">

<div class="rst-content style-external-links">

    


    <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    <div itemprop="articleBody">
    
  <h1>Source code for rmakers.functions</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The rmakers functions.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">types</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">abjad</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">classes</span> <span class="k">as</span> <span class="n">_classes</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_function_name</span><span class="p">(</span><span class="n">frame</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">FrameType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">:</span>
    <span class="k">assert</span> <span class="n">frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="n">function_name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
    <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;rmakers.</span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2">()&quot;</span>
    <span class="k">return</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_component_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Component</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_container_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Container</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_container_or_component_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Container</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">_is_component_list</span><span class="p">(</span><span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_duration_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_integer_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_leaf_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_list_of_leaf_lists</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_is_leaf_list</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_pleaf_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Chord</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_time_signature_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">TimeSignature</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_is_tuplet_list</span><span class="p">(</span><span class="n">argument</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">argument</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_make_beamable_groups</span><span class="p">(</span>
    <span class="n">components</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Component</span><span class="p">],</span>
    <span class="n">durations</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Component</span><span class="p">]]:</span>
    <span class="k">assert</span> <span class="n">_is_component_list</span><span class="p">(</span><span class="n">components</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="n">music_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">music_duration</span> <span class="o">!=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;music duration </span><span class="si">{</span><span class="n">music_duration</span><span class="si">}</span><span class="s2"> does not equal&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; total duration </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">components</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">durations</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">component_to_timespan</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_offset</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">components</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
        <span class="n">stop_offset</span> <span class="o">=</span> <span class="n">start_offset</span> <span class="o">+</span> <span class="n">duration</span>
        <span class="n">timespan</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">stop_offset</span><span class="p">)</span>
        <span class="n">component_to_timespan</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">component</span><span class="p">,</span> <span class="n">timespan</span><span class="p">))</span>
        <span class="n">start_offset</span> <span class="o">=</span> <span class="n">stop_offset</span>
    <span class="n">group_to_target_duration</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">start_offset</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">duration</span><span class="o">.</span><span class="n">offset</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">target_duration</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">:</span>
        <span class="n">stop_offset</span> <span class="o">=</span> <span class="n">start_offset</span> <span class="o">+</span> <span class="n">target_duration</span>
        <span class="n">group_timespan</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Timespan</span><span class="p">(</span><span class="n">start_offset</span><span class="p">,</span> <span class="n">stop_offset</span><span class="p">)</span>
        <span class="n">start_offset</span> <span class="o">=</span> <span class="n">stop_offset</span>
        <span class="n">group</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">component_timespan</span> <span class="ow">in</span> <span class="n">component_to_timespan</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">component_timespan</span> <span class="ow">in</span> <span class="n">group_timespan</span><span class="p">:</span>
                <span class="n">group</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
        <span class="n">group_to_target_duration</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">group</span><span class="p">,</span> <span class="n">target_duration</span><span class="p">))</span>
    <span class="n">beamable_groups</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">group</span><span class="p">,</span> <span class="n">target_duration</span> <span class="ow">in</span> <span class="n">group_to_target_duration</span><span class="p">:</span>
        <span class="n">group_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">group_duration</span> <span class="o">&lt;=</span> <span class="n">target_duration</span>
        <span class="k">if</span> <span class="n">group_duration</span> <span class="o">==</span> <span class="n">target_duration</span><span class="p">:</span>
            <span class="n">beamable_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">beamable_groups</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="k">return</span> <span class="n">beamable_groups</span>


<div class="viewcode-block" id="attach_beams_to_runs_by_leaf_list">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.attach_beams_to_runs_by_leaf_list">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">attach_beams_to_runs_by_leaf_list</span><span class="p">(</span>
    <span class="n">leaf_lists</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">beam_lone_notes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">beam_rests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">stemlet_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attaches beams to runs in each leaf list in ``leaf_lists``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs, beam_rests=False, stemlet_length=None):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1, 1, 1, -1], 16)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(</span>
<span class="sd">        ...         leaf_lists,</span>
<span class="sd">        ...         beam_rests=beam_rests,</span>
<span class="sd">        ...         stemlet_length=stemlet_length,</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     rmakers.swap_trivial_tuplets_for_containers(tuplets)</span>
<span class="sd">        ...     score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">        ...     abjad.setting(score).autoBeaming = False</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Beams each run in each tuplet:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                autoBeaming = ##f</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Set ``beam_rests=True`` and ``stemlet_length=n`` to beam rests with</span>
<span class="sd">        stemlets of length ``n``:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(</span>
<span class="sd">        ...     pairs, beam_rests=True, stemlet_length=0.75</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                autoBeaming = ##f</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \override RhythmicStaff.Stem.stemlet-length = 0.75</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \revert RhythmicStaff.Stem.stemlet-length</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \override RhythmicStaff.Stem.stemlet-length = 0.75</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \revert RhythmicStaff.Stem.stemlet-length</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \override RhythmicStaff.Stem.stemlet-length = 0.75</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            r16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \revert RhythmicStaff.Stem.stemlet-length</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \override RhythmicStaff.Stem.stemlet-length = 0.75</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            r16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            r16</span>
<span class="sd">                            ]</span>
<span class="sd">                            \revert RhythmicStaff.Stem.stemlet-length</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        By default, ``rmakers.attach_beams_to_runs_by_leaf_list()`` unbeams input before applying new beams:</span>

<span class="sd">        &gt;&gt;&gt; staff = abjad.Staff(r&quot;c&#39;8 [ c&#39;8 c&#39;8 ] c&#39;8 [ c&#39;8 c&#39;8 ] c&#39;8 c&#39;8&quot;)</span>
<span class="sd">        &gt;&gt;&gt; abjad.setting(staff).autoBeaming = False</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \new Staff</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                autoBeaming = ##f</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                [</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                ]</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                [</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                ]</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">            }</span>

<span class="sd">        &gt;&gt;&gt; rmakers.attach_beams_to_runs_by_leaf_list([staff[:]])</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(staff) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(staff)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \new Staff</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                autoBeaming = ##f</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                [</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                c&#39;8</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_list_of_leaf_lists</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">leaf_list</span> <span class="ow">in</span> <span class="n">leaf_lists</span><span class="p">:</span>
        <span class="n">detach_beams_from_leaves</span><span class="p">(</span><span class="n">leaf_list</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">beam</span><span class="p">(</span>
            <span class="n">leaf_list</span><span class="p">,</span>
            <span class="n">beam_lone_notes</span><span class="o">=</span><span class="n">beam_lone_notes</span><span class="p">,</span>
            <span class="n">beam_rests</span><span class="o">=</span><span class="n">beam_rests</span><span class="p">,</span>
            <span class="n">stemlet_length</span><span class="o">=</span><span class="n">stemlet_length</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="attach_invisible_music_commands_to_leaves">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.attach_invisible_music_commands_to_leaves">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">attach_invisible_music_commands_to_leaves</span><span class="p">(</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attaches invisible music commands to each leaf in ``leaves``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_leaf_list</span><span class="p">(</span><span class="n">leaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="n">tag_1</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(</span><span class="s2">&quot;INVISIBLE_MUSIC_COMMAND&quot;</span><span class="p">))</span>
    <span class="n">literal_1</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">LilyPondLiteral</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\abjad-invisible-music&quot;</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="n">tag_2</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(</span><span class="s2">&quot;INVISIBLE_MUSIC_COLORING&quot;</span><span class="p">))</span>
    <span class="n">literal_2</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">LilyPondLiteral</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\abjad-invisible-music-coloring&quot;</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">literal_1</span><span class="p">,</span> <span class="n">leaf</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag_1</span><span class="p">,</span> <span class="n">deactivate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">literal_2</span><span class="p">,</span> <span class="n">leaf</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag_2</span><span class="p">)</span></div>



<div class="viewcode-block" id="attach_repeat_ties_to_pleaves">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.attach_repeat_ties_to_pleaves">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">attach_repeat_ties_to_pleaves</span><span class="p">(</span>
    <span class="n">pleaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Chord</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attaches repeat-tie to each pitched leaf in ``pleaves``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Attaches repeat-tie to first pitched leaf in each nonfirst tuplet:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     voice = abjad.Voice(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)[1:]</span>
<span class="sd">        ...     notes = [abjad.select.note(_, 0) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_repeat_ties_to_pleaves(notes)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(voice)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8), (2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Attaches repeat-ties to nonfirst notes in each tuplet:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     voice = abjad.Voice(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)</span>
<span class="sd">        ...     notes = [abjad.select.notes(_)[1:] for _ in tuplets]</span>
<span class="sd">        ...     notes = abjad.sequence.flatten(notes)</span>
<span class="sd">        ...     rmakers.attach_repeat_ties_to_pleaves(notes)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(voice)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8), (2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_pleaf_list</span><span class="p">(</span><span class="n">pleaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">pleaves</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">pleaf</span> <span class="ow">in</span> <span class="n">pleaves</span><span class="p">:</span>
        <span class="n">tie</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">RepeatTie</span><span class="p">()</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">tie</span><span class="p">,</span> <span class="n">pleaf</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span></div>



<div class="viewcode-block" id="attach_ties_to_pleaves">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.attach_ties_to_pleaves">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">attach_ties_to_pleaves</span><span class="p">(</span>
    <span class="n">pleaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Note</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Chord</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attaches tie to each pitched pleaf in ``pleaves``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Attaches tie to last pitched leaf in each nonlast tuplet:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(tuplets)[:-1]</span>
<span class="sd">        ...     notes = [abjad.select.note(_, -1) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(notes)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8), (2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Ties the last leaf of nonlast tuplets:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [5, 3, 3, 3], 16)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(tuplets)[:-1]</span>
<span class="sd">        ...     leaves = [abjad.select.leaf(_, -1) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(leaves)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 8), (3, 8), (4, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Ties across every other tuplet:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [5, 3, 3, 3], 16)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     tuplets = abjad.select.get(tuplets[:-1], [0], 2)</span>
<span class="sd">        ...     leaves = [abjad.select.leaf(_, -1) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(leaves)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 8), (3, 8), (4, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        TIE-CONSECUTIVE-NOTES RECIPE:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [5, -3, 3, 3], 16)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaves = abjad.select.leaves(voice)</span>
<span class="sd">        ...     rmakers.detach_ties_from_leaves(leaves)</span>
<span class="sd">        ...     runs = abjad.select.runs(voice)</span>
<span class="sd">        ...     notes = [abjad.select.notes(_)[:-1] for _ in runs]</span>
<span class="sd">        ...     notes = abjad.sequence.flatten(notes)</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(notes)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 8), (3, 8), (4, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        r8.</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        [</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        r8.</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        [</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>


<span class="sd">    ..  container:: example</span>

<span class="sd">        Attaches ties to nonlast notes in each tuplet:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     notes = [abjad.select.notes(_)[:-1] for _ in tuplets]</span>
<span class="sd">        ...     notes = abjad.sequence.flatten(notes)</span>
<span class="sd">        ...     rmakers.detach_ties_from_leaves(notes)</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(notes)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8), (2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_pleaf_list</span><span class="p">(</span><span class="n">pleaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">pleaves</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">pleaf</span> <span class="ow">in</span> <span class="n">pleaves</span><span class="p">:</span>
        <span class="n">tie</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">()</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">tie</span><span class="p">,</span> <span class="n">pleaf</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span></div>



<div class="viewcode-block" id="attach_span_beams_to_runs_across_leaf_lists">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.attach_span_beams_to_runs_across_leaf_lists">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">attach_span_beams_to_runs_across_leaf_lists</span><span class="p">(</span>
    <span class="n">leaf_lists</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">beam_lone_notes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">beam_rests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">stemlet_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attaches span beams to runs across ``leaf_lists``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1], 16)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_span_beams_to_runs_across_leaf_lists(leaf_lists)</span>
<span class="sd">        ...     rmakers.swap_trivial_tuplets_for_containers(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \set stemLeftBeamCount = 0</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 1</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \set stemLeftBeamCount = 1</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 1</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \set stemLeftBeamCount = 1</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 1</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            \set stemLeftBeamCount = 1</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 2</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            \set stemLeftBeamCount = 2</span>
<span class="sd">                            \set stemRightBeamCount = 0</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_list_of_leaf_lists</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="n">leaves</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">)</span>
    <span class="n">detach_beams_from_leaves</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">leaf_lists</span><span class="p">]</span>
    <span class="n">leaves</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">)</span>
    <span class="n">abjad</span><span class="o">.</span><span class="n">beam</span><span class="p">(</span>
        <span class="n">leaves</span><span class="p">,</span>
        <span class="n">beam_lone_notes</span><span class="o">=</span><span class="n">beam_lone_notes</span><span class="p">,</span>
        <span class="n">beam_rests</span><span class="o">=</span><span class="n">beam_rests</span><span class="p">,</span>
        <span class="n">durations</span><span class="o">=</span><span class="n">durations</span><span class="p">,</span>
        <span class="n">span_beam_count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">stemlet_length</span><span class="o">=</span><span class="n">stemlet_length</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="detach_beams_from_leaves">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.detach_beams_from_leaves">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">detach_beams_from_leaves</span><span class="p">(</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detaches beam indicators from each leaf in ``leaves``.</span>

<span class="sd">    Beam indicators are ``abjad.StartBeam``, ``abjad.StopBeam``,</span>
<span class="sd">    ``abjad.BeamCount``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_leaf_list</span><span class="p">(</span><span class="n">leaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">BeamCount</span><span class="p">,</span> <span class="n">leaf</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">StartBeam</span><span class="p">,</span> <span class="n">leaf</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">StopBeam</span><span class="p">,</span> <span class="n">leaf</span><span class="p">)</span></div>



<div class="viewcode-block" id="detach_ties_from_leaves">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.detach_ties_from_leaves">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">detach_ties_from_leaves</span><span class="p">(</span><span class="n">leaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detaches ties from each leaf in ``leaves``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Attaches ties to nonlast notes; then detaches ties from select notes:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     notes = abjad.select.notes(voice)[:-1]</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(notes)</span>
<span class="sd">        ...     notes = abjad.select.notes(voice)</span>
<span class="sd">        ...     notes = abjad.select.get(notes, [0], 4)</span>
<span class="sd">        ...     rmakers.detach_ties_from_leaves(notes)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8), (2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Attaches repeat-ties to nonfirst notes; then detaches ties from select notes:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     voice = abjad.Voice(tuplets)</span>
<span class="sd">        ...     notes = abjad.select.notes(voice)[1:]</span>
<span class="sd">        ...     rmakers.attach_repeat_ties_to_pleaves(notes)</span>
<span class="sd">        ...     notes = abjad.select.notes(voice)</span>
<span class="sd">        ...     notes = abjad.select.get(notes, [0], 4)</span>
<span class="sd">        ...     rmakers.detach_ties_from_leaves(notes)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(voice)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8), (2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_leaf_list</span><span class="p">(</span><span class="n">leaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">,</span> <span class="n">leaf</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">RepeatTie</span><span class="p">,</span> <span class="n">leaf</span><span class="p">)</span></div>



<div class="viewcode-block" id="extract_rest_filled_tuplets">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.extract_rest_filled_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_rest_filled_tuplets</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts each rest-filled tuplet in ``tuplets``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">is_rest_filled</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span></div>



<div class="viewcode-block" id="extract_trivial_tuplets">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.extract_trivial_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_trivial_tuplets</span><span class="p">(</span><span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extracts each trivial tuplet in ``tuplets``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)[-2:]</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (3, 8), (3, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/3</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/3</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">is_trivial</span><span class="p">():</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span></div>



<div class="viewcode-block" id="override_beam_grow_direction">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.override_beam_grow_direction">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">override_beam_grow_direction</span><span class="p">(</span>
    <span class="n">leaf_lists</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">]],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">beam_rests</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">stemlet_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overrides ``Beam.grow-direction`` on first leaf of each leaf list in</span>
<span class="sd">    ``leaf_lists``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file():</span>
<span class="sd">        ...     voice = abjad.Voice(&quot;c&#39;16 d&#39; r f&#39; g&#39;8&quot;)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(</span>
<span class="sd">        ...         [voice[:]],</span>
<span class="sd">        ...         beam_rests=True,</span>
<span class="sd">        ...         stemlet_length=1,</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     rmakers.override_beam_grow_direction([voice[:]])</span>
<span class="sd">        ...     staff = abjad.Staff([voice])</span>
<span class="sd">        ...     score = abjad.Score([staff], name=&quot;Score&quot;)</span>
<span class="sd">        ...     lilypond_file = abjad.LilyPondFile([score])</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file()</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            &lt;&lt;</span>
<span class="sd">                \new Staff</span>
<span class="sd">                {</span>
<span class="sd">                    \new Voice</span>
<span class="sd">                    {</span>
<span class="sd">                        \override Staff.Stem.stemlet-length = 1</span>
<span class="sd">                        \once \override Beam.grow-direction = #left</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        d&#39;16</span>
<span class="sd">                        r16</span>
<span class="sd">                        f&#39;16</span>
<span class="sd">                        g&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                        \revert Staff.Stem.stemlet-length</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            &gt;&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_list_of_leaf_lists</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">beam_rests</span><span class="p">,</span> <span class="nb">bool</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">beam_rests</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stemlet_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stemlet_length</span><span class="p">,</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">stemlet_length</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">leaf_list</span> <span class="ow">in</span> <span class="n">leaf_lists</span><span class="p">:</span>
        <span class="n">first_leaf</span> <span class="o">=</span> <span class="n">leaf_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">last_leaf</span> <span class="o">=</span> <span class="n">leaf_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">first_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">first_leaf</span><span class="p">)</span>
        <span class="n">last_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">last_leaf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">last_duration</span> <span class="o">&lt;</span> <span class="n">first_duration</span><span class="p">:</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="n">first_leaf</span><span class="p">)</span><span class="o">.</span><span class="n">Beam</span><span class="o">.</span><span class="n">grow_direction</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">RIGHT</span>
        <span class="k">elif</span> <span class="n">first_duration</span> <span class="o">&lt;</span> <span class="n">last_duration</span><span class="p">:</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="n">first_leaf</span><span class="p">)</span><span class="o">.</span><span class="n">Beam</span><span class="o">.</span><span class="n">grow_direction</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">LEFT</span></div>



<div class="viewcode-block" id="override_tuplet_number_text_duration_markup">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.override_tuplet_number_text_duration_markup">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">override_tuplet_number_text_duration_markup</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overrides ``TupletNumber.text`` of each tuplet in ``tuplets``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">pitch_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">NamedPitch</span><span class="p">(</span><span class="s2">&quot;c&#39;&quot;</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_leaves</span><span class="p">([</span><span class="n">pitch_list</span><span class="p">],</span> <span class="p">[</span><span class="n">duration</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">components</span><span class="p">):</span>
            <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">components</span><span class="p">]</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">lilypond_duration_string</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">]</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="sa">rf</span><span class="s2">&quot;\rhythm </span><span class="se">{{</span><span class="s2"> </span><span class="si">{</span><span class="n">_</span><span class="si">}</span><span class="s2"> </span><span class="se">}}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">]</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot; + &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
                <span class="n">string</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">{{</span><span class="s2"> </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> </span><span class="se">}}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">illustrators</span><span class="o">.</span><span class="n">components_to_score_markup_string</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
        <span class="n">string</span> <span class="o">=</span> <span class="sa">rf</span><span class="s2">&quot;\markup \scale #&#39;(0.75 . 0.75) </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span><span class="o">.</span><span class="n">TupletNumber</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">string</span></div>



<div class="viewcode-block" id="reduce_tuplet_ratios">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.reduce_tuplet_ratios">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">reduce_tuplet_ratios</span><span class="p">(</span><span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduces ratio of each tuplet in ``tuplets``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Ratio</span><span class="p">(</span>
            <span class="n">tuplet</span><span class="o">.</span><span class="n">multiplier</span><span class="p">()</span><span class="o">.</span><span class="n">denominator</span><span class="p">,</span>
            <span class="n">tuplet</span><span class="o">.</span><span class="n">multiplier</span><span class="p">()</span><span class="o">.</span><span class="n">numerator</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tuplet</span><span class="o">.</span><span class="n">set_ratio</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span></div>



<div class="viewcode-block" id="replace_leaves_with_notes">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.replace_leaves_with_notes">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">replace_leaves_with_notes</span><span class="p">(</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces each leaf in ``leaves`` with note.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Changes logical ties 1 and 2 to notes:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     components = rmakers.make_notes(durations)</span>
<span class="sd">        ...     container = abjad.Container(components)</span>
<span class="sd">        ...     rmakers.replace_leaves_with_rests(components)</span>
<span class="sd">        ...     rests = container[1:3]</span>
<span class="sd">        ...     rmakers.replace_leaves_with_notes(rests)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(7, 16), (3, 8), (7, 16), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        r4..</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        c&#39;4..</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        r4.</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Changes leaves to notes with inverted composite pattern:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     components = rmakers.make_notes(durations)</span>
<span class="sd">        ...     container = abjad.Container(components)</span>
<span class="sd">        ...     leaves = abjad.select.leaves(container)</span>
<span class="sd">        ...     rmakers.replace_leaves_with_rests(leaves)</span>
<span class="sd">        ...     leaves = abjad.select.get(container[:], [0, -1])</span>
<span class="sd">        ...     rmakers.replace_leaves_with_notes(leaves)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(7, 16), (3, 8), (7, 16), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        c&#39;4..</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        r4.</span>
<span class="sd">                        \time 7/16</span>
<span class="sd">                        r4..</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;4.</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_leaf_list</span><span class="p">(</span><span class="n">leaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="n">pitch</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">NamedPitch</span><span class="p">(</span><span class="s2">&quot;C4&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">leaf</span><span class="o">.</span><span class="n">written_duration</span><span class="p">()</span>
        <span class="n">note</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">from_duration_and_pitch</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">pitch</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">leaf</span><span class="o">.</span><span class="n">dmp</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">note</span><span class="o">.</span><span class="n">set_dmp</span><span class="p">(</span><span class="n">leaf</span><span class="o">.</span><span class="n">dmp</span><span class="p">())</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="p">[</span><span class="n">note</span><span class="p">])</span></div>



<div class="viewcode-block" id="replace_leaves_with_rests">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.replace_leaves_with_rests">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">replace_leaves_with_rests</span><span class="p">(</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces each leaf in ``leaves`` with rest.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Forces first and last logical ties to rest:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1, 2, 3, 4], 16)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaves = abjad.select.leaves(voice)</span>
<span class="sd">        ...     leaves = abjad.select.get(leaves, [0, -1])</span>
<span class="sd">        ...     rmakers.replace_leaves_with_rests(leaves)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.docs.attach_time_signatures(voice, time_signatures)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        r8</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Forces all logical ties to rest. Then sustains first and last logical ties:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1, 2, 3, 4], 16)</span>
<span class="sd">        ...     container = abjad.Container(tuplets)</span>
<span class="sd">        ...     leaves = abjad.select.leaves(container)</span>
<span class="sd">        ...     rmakers.replace_leaves_with_rests(leaves)</span>
<span class="sd">        ...     leaves = abjad.select.leaves(container)</span>
<span class="sd">        ...     rests = abjad.select.get(leaves[:], [0, -1])</span>
<span class="sd">        ...     rmakers.replace_leaves_with_notes(rests)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        r8</span>
<span class="sd">                        r8.</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        r4</span>
<span class="sd">                        r16</span>
<span class="sd">                        r8</span>
<span class="sd">                        r16</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        r8</span>
<span class="sd">                        r4</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        r16</span>
<span class="sd">                        r8</span>
<span class="sd">                        r8.</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Forces every other tuplet to rest:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1, 2, 3, 4], 16)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     tuplets = abjad.select.get(tuplets, [1], 2)</span>
<span class="sd">        ...     leaves = abjad.select.leaves(tuplets)</span>
<span class="sd">        ...     rmakers.replace_leaves_with_rests(leaves)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)</span>
<span class="sd">        ...     rmakers.rewrite_rest_filled_tuplets(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     rmakers.docs.attach_time_signatures(voice, time_signatures)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        r2</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        r2</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Forces the first leaf and the last two leaves to rests:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1, 2, 3, 4], 16)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaves = abjad.select.leaves(voice)</span>
<span class="sd">        ...     leaves = abjad.select.get(leaves, [0, -2, -1])</span>
<span class="sd">        ...     rmakers.replace_leaves_with_rests(leaves)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     rmakers.docs.attach_time_signatures(voice, time_signatures)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                        r8.</span>
<span class="sd">                        r8</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Forces first leaf of every tuplet to rest:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1, 2, 3, 4], 16)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     leaves = [abjad.select.leaf(_, 0) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.replace_leaves_with_rests(leaves)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     rmakers.docs.attach_time_signatures(voice, time_signatures)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        r4</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        ]</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        r8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        r16</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_leaf_list</span><span class="p">(</span><span class="n">leaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">leaf</span><span class="o">.</span><span class="n">written_duration</span><span class="p">()</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Rest</span><span class="o">.</span><span class="n">from_duration</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">leaf</span><span class="o">.</span><span class="n">dmp</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">rest</span><span class="o">.</span><span class="n">set_dmp</span><span class="p">(</span><span class="n">leaf</span><span class="o">.</span><span class="n">dmp</span><span class="p">())</span>
        <span class="n">previous_leaf</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">leaf</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">next_leaf</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">leaf</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="p">[</span><span class="n">rest</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">previous_leaf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">,</span> <span class="n">previous_leaf</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">RepeatTie</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">next_leaf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">RepeatTie</span><span class="p">,</span> <span class="n">next_leaf</span><span class="p">)</span></div>



<div class="viewcode-block" id="replace_ties_with_repeat_ties">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.replace_ties_with_repeat_ties">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">replace_ties_with_repeat_ties</span><span class="p">(</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
    <span class="n">threshold</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Callable</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replaces ties attached to ``leaves`` with repeat-ties.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)[:-1]</span>
<span class="sd">        ...     notes = [abjad.select.note(_, -1) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(notes)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Attaches tie to last note in each nonlast tuplet:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Changes ties to repeat-ties:</span>

<span class="sd">        &gt;&gt;&gt; leaves = abjad.select.leaves(lilypond_file[&quot;Score&quot;])</span>
<span class="sd">        &gt;&gt;&gt; rmakers.replace_ties_with_repeat_ties(leaves)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            \repeatTie</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_leaf_list</span><span class="p">(</span><span class="n">leaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">threshold</span><span class="p">):</span>
        <span class="n">inequality</span> <span class="o">=</span> <span class="n">threshold</span>
    <span class="k">elif</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">inequality</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">item</span> <span class="o">&lt;</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">inequality</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">item</span> <span class="o">&gt;=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">inequality</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">item</span> <span class="o">&gt;=</span> <span class="n">threshold</span>

    <span class="n">attach_repeat_ties</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">has_indicator</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">):</span>
            <span class="n">next_leaf</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">leaf</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">next_leaf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">next_leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Chord</span> <span class="o">|</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Note</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">has_indicator</span><span class="p">(</span><span class="n">next_leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">RepeatTie</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">leaf</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inequality</span><span class="p">(</span><span class="n">duration</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">attach_repeat_ties</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_leaf</span><span class="p">)</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">,</span> <span class="n">leaf</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">attach_repeat_ties</span><span class="p">:</span>
        <span class="n">repeat_tie</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">RepeatTie</span><span class="p">()</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">repeat_tie</span><span class="p">,</span> <span class="n">leaf</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span></div>



<div class="viewcode-block" id="respell_leaves_written_duration_and_dmp">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.respell_leaves_written_duration_and_dmp">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">respell_leaves_written_duration_and_dmp</span><span class="p">(</span>
    <span class="n">leaves</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">],</span>
    <span class="n">written_duration</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Respells written duration and DMP of each leaf in ``leaves``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_leaf_list</span><span class="p">(</span><span class="n">leaves</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">written_duration</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">written_duration</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
        <span class="n">old_duration</span> <span class="o">=</span> <span class="n">leaf</span><span class="o">.</span><span class="n">written_duration</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">written_duration</span> <span class="o">==</span> <span class="n">old_duration</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">leaf</span><span class="o">.</span><span class="n">set_written_duration</span><span class="p">(</span><span class="n">written_duration</span><span class="p">)</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="n">old_duration</span> <span class="o">/</span> <span class="n">written_duration</span>
        <span class="n">leaf</span><span class="o">.</span><span class="n">set_dmp</span><span class="p">(</span><span class="n">fraction</span><span class="o">.</span><span class="n">as_integer_ratio</span><span class="p">())</span></div>



<div class="viewcode-block" id="respell_tuplets_without_dots">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.respell_tuplets_without_dots">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">respell_tuplets_without_dots</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Respells ``tuplets`` without dots.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="n">tuplet</span><span class="o">.</span><span class="n">respell_without_dots</span><span class="p">()</span></div>



<div class="viewcode-block" id="rewrite_meter">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.rewrite_meter">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rewrite_meter</span><span class="p">(</span>
    <span class="n">voice</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">boundary_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reference_meters</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Meter</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rewrites meter of components in ``voice``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Rewrites meter. Uses ``rmakers.wrap_in_time_signature_staff()`` to make</span>
<span class="sd">        sure ``voice`` appears together with time signature information in a</span>
<span class="sd">        staff.</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [5, 4], 16)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     voice = rmakers.wrap_in_time_signature_staff(tuplets, time_signatures)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     rmakers.rewrite_meter(voice)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(voice)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 4), (3, 4), (3, 4)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        ]</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Container</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>
    <span class="n">staff</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">parentage</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">staff</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Staff</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">staff</span><span class="p">)</span>
    <span class="n">time_signature_voice</span> <span class="o">=</span> <span class="n">staff</span><span class="p">[</span><span class="s2">&quot;TimeSignatureVoice&quot;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_signature_voice</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">reference_meters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reference_meters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reference_meters</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">reference_meters</span><span class="p">)</span>
    <span class="n">meters</span><span class="p">,</span> <span class="n">preferred_meters</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">skip</span> <span class="ow">in</span> <span class="n">time_signature_voice</span><span class="p">:</span>
        <span class="n">time_signature</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">indicator</span><span class="p">(</span><span class="n">skip</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">TimeSignature</span><span class="p">)</span>
        <span class="n">rtc</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">meter</span><span class="o">.</span><span class="n">make_best_guess_rtc</span><span class="p">(</span><span class="n">time_signature</span><span class="o">.</span><span class="n">pair</span><span class="p">)</span>
        <span class="n">meter</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Meter</span><span class="p">(</span><span class="n">rtc</span><span class="p">)</span>
        <span class="n">meters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meter</span><span class="p">)</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">duration</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">meters</span><span class="p">]</span>
    <span class="n">split_measures</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="n">durations</span><span class="o">=</span><span class="n">durations</span><span class="p">)</span>
    <span class="n">lists</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">group_by_measure</span><span class="p">(</span><span class="n">voice</span><span class="p">[:])</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">lists</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">lists</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">meter</span><span class="p">,</span> <span class="n">list_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">meters</span><span class="p">,</span> <span class="n">lists</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">reference_meter</span> <span class="ow">in</span> <span class="n">reference_meters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">reference_meter</span><span class="o">.</span><span class="n">pair</span><span class="p">()</span> <span class="o">==</span> <span class="n">meter</span><span class="o">.</span><span class="n">pair</span><span class="p">():</span>
                <span class="n">meter</span> <span class="o">=</span> <span class="n">reference_meter</span>
                <span class="k">break</span>
        <span class="n">preferred_meters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meter</span><span class="p">)</span>
        <span class="n">nontupletted_leaves</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">abjad</span><span class="o">.</span><span class="n">iterate</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">list_</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">parentage</span><span class="p">(</span><span class="n">leaf</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">):</span>
                <span class="n">nontupletted_leaves</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leaf</span><span class="p">)</span>
        <span class="n">detach_beams_from_leaves</span><span class="p">(</span><span class="n">nontupletted_leaves</span><span class="p">)</span>
        <span class="n">meter</span><span class="o">.</span><span class="n">rewrite</span><span class="p">(</span>
            <span class="n">list_</span><span class="p">,</span>
            <span class="n">boundary_depth</span><span class="o">=</span><span class="n">boundary_depth</span><span class="p">,</span>
            <span class="n">do_not_rewrite_tuplets</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">lists</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">group_by_measure</span><span class="p">(</span><span class="n">voice</span><span class="p">[:])</span>
    <span class="k">for</span> <span class="n">meter</span><span class="p">,</span> <span class="n">list_</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">preferred_meters</span><span class="p">,</span> <span class="n">lists</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">list_</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">beat_durations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">beat_offsets</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">depthwise_offset_inventory</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">abjad</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">nwise</span><span class="p">(</span><span class="n">beat_offsets</span><span class="p">):</span>
            <span class="n">beat_duration</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span>
            <span class="n">beat_durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beat_duration</span><span class="p">)</span>
        <span class="n">beamable_groups</span> <span class="o">=</span> <span class="n">_make_beamable_groups</span><span class="p">(</span><span class="n">leaves</span><span class="p">,</span> <span class="n">beat_durations</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">beamable_group</span> <span class="ow">in</span> <span class="n">beamable_groups</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">beamable_group</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">beam</span><span class="p">(</span>
                <span class="n">beamable_group</span><span class="p">,</span>
                <span class="n">beam_rests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
            <span class="p">)</span></div>



<div class="viewcode-block" id="rewrite_rest_filled_tuplets">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.rewrite_rest_filled_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rewrite_rest_filled_tuplets</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">spelling</span><span class="p">:</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rewrites rest-filled tuplets in ``tuplets``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Does not rewrite rest-filled tuplets:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [-1], 16, extra_counts=[1])</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     container = abjad.Container(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 16), (4, 16), (5, 16), (5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 5/4</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 5/4</span>
<span class="sd">                        {</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 6/5</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 5/16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 6/5</span>
<span class="sd">                        {</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Rewrites rest-filled tuplets:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [-1], 16, extra_counts=[1])</span>
<span class="sd">        ...     container = abjad.Container(tuplets)</span>
<span class="sd">        ...     rmakers.rewrite_rest_filled_tuplets(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 16), (4, 16), (5, 16), (5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/16</span>
<span class="sd">                        r4</span>
<span class="sd">                        r4</span>
<span class="sd">                        \time 5/16</span>
<span class="sd">                        r4</span>
<span class="sd">                        r16</span>
<span class="sd">                        r4</span>
<span class="sd">                        r16</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        With spelling specifier:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [-1], 16, extra_counts=[1])</span>
<span class="sd">        ...     container = abjad.Container(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)</span>
<span class="sd">        ...     spelling = rmakers.Spelling(increase_monotonic=True)</span>
<span class="sd">        ...     rmakers.rewrite_rest_filled_tuplets(tuplets, spelling=spelling)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 16), (4, 16), (5, 16), (5, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/16</span>
<span class="sd">                        r4</span>
<span class="sd">                        r4</span>
<span class="sd">                        \time 5/16</span>
<span class="sd">                        r16</span>
<span class="sd">                        r4</span>
<span class="sd">                        r16</span>
<span class="sd">                        r4</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Working with ``rewrite_rest_filled_tuplets``.</span>

<span class="sd">        Makes rest-filled tuplets:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">        ...         durations, [3, 3, -6, -6], 16, extra_counts=[1, 0]</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 7/6</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            ]</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            r4</span>
<span class="sd">                            r16</span>
<span class="sd">                            r8.</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 7/6</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            r8.</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            r4.</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Rewrites rest-filled tuplets:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">        ...         durations,</span>
<span class="sd">        ...         [3, 3, -6, -6],</span>
<span class="sd">        ...         16,</span>
<span class="sd">        ...         extra_counts=[1, 0],</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.rewrite_rest_filled_tuplets(tuplets)</span>
<span class="sd">        ...     rmakers.docs.attach_time_signatures(voice, time_signatures)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 7/6</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            ]</span>
<span class="sd">                            r16</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            r2</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 7/6</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            r8.</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            r4.</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">spelling</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">spelling</span> <span class="o">=</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spelling</span><span class="p">,</span> <span class="n">_classes</span><span class="o">.</span><span class="n">Spelling</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">spelling</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">is_rest_filled</span><span class="p">():</span>
            <span class="k">continue</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
        <span class="n">rests</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">makers</span><span class="o">.</span><span class="n">make_leaves</span><span class="p">(</span>
            <span class="p">[[]],</span>
            <span class="p">[</span><span class="n">duration</span><span class="p">],</span>
            <span class="n">increase_monotonic</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">increase_monotonic</span><span class="p">,</span>
            <span class="n">forbidden_note_duration</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">forbidden_note_duration</span><span class="p">,</span>
            <span class="n">forbidden_rest_duration</span><span class="o">=</span><span class="n">spelling</span><span class="o">.</span><span class="n">forbidden_rest_duration</span><span class="p">,</span>
            <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tuplet</span><span class="p">[:],</span> <span class="n">rests</span><span class="p">)</span>
        <span class="n">tuplet</span><span class="o">.</span><span class="n">set_ratio</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Ratio</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span></div>



<div class="viewcode-block" id="rewrite_sustained_tuplets">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.rewrite_sustained_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rewrite_sustained_tuplets</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rewrites sustained tuplets in ``tuplets``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Sustained tuplets generalize a class of rhythms composers are likely to</span>
<span class="sd">        rewrite:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">        ...         durations, [6, 5, 5, 4, 1], 16, extra_counts=[2, 1, 1, 1]</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     container = abjad.Container(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)[1:3]</span>
<span class="sd">        ...     leaves = [abjad.select.leaf(_, -1) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(leaves)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 16), (4, 16), (4, 16), (4, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/16</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 5/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 5/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 5/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        The first three tuplets in the example above qualify as sustained:</span>

<span class="sd">            &gt;&gt;&gt; staff = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; for tuplet in abjad.select.tuplets(staff):</span>
<span class="sd">            ...     abjad.get.is_sustained(tuplet)</span>
<span class="sd">            ...</span>
<span class="sd">            True</span>
<span class="sd">            True</span>
<span class="sd">            True</span>
<span class="sd">            False</span>

<span class="sd">        Tuplets 0 and 1 each contain only a single **tuplet-initial** attack. Tuplet 2</span>
<span class="sd">        contains no attack at all. All three fill their duration completely.</span>

<span class="sd">        Tuplet 3 contains a **nonintial** attack that rearticulates the tuplet&#39;s duration</span>
<span class="sd">        midway through the course of the figure. Tuplet 3 does not qualify as sustained.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Rewrite sustained tuplets like this:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">        ...         durations, [6, 5, 5, 4, 1], 16, extra_counts=[2, 1, 1, 1]</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     container = abjad.Container(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)[1:3]</span>
<span class="sd">        ...     leaves = [abjad.select.leaf(_, -1) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(leaves)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)</span>
<span class="sd">        ...     rmakers.rewrite_sustained_tuplets(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container, level=1)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 16), (4, 16), (4, 16), (4, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/16</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            ~</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 5/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Rewrite sustained tuplets -- and then extract the trivial tuplets that result --</span>
<span class="sd">        like this:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">        ...         durations, [6, 5, 5, 4, 1], 16, extra_counts=[2, 1, 1, 1]</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     container = abjad.Container(tuplets)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)[1:3]</span>
<span class="sd">        ...     leaves = [abjad.select.leaf(_, -1) for _ in tuplets]</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(leaves)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)</span>
<span class="sd">        ...     rmakers.rewrite_sustained_tuplets(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(container)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     components = abjad.mutate.eject_contents(container)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         components, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(4, 16), (4, 16), (4, 16), (4, 16)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 4/16</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        ~</span>
<span class="sd">                        \tuplet 5/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     notes = [abjad.select.notes(_)[:-1] for _ in tuplets]</span>
<span class="sd">        ...     notes = abjad.sequence.flatten(notes)</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(notes)</span>
<span class="sd">        ...     rmakers.rewrite_sustained_tuplets(tuplets[-2:])</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ~</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Sustains every other tuplet:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1, 2, 3, 4], 16)</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     tuplets = abjad.select.get(tuplets, [1], 2)</span>
<span class="sd">        ...     notes = [abjad.select.notes(_)[:-1] for _ in tuplets]</span>
<span class="sd">        ...     notes = abjad.sequence.flatten(notes)</span>
<span class="sd">        ...     rmakers.attach_ties_to_pleaves(notes)</span>
<span class="sd">        ...     rmakers.rewrite_sustained_tuplets(tuplets)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)</span>
<span class="sd">        ...     rmakers.extract_trivial_tuplets(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;16</span>
<span class="sd">                        [</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;8.</span>
<span class="sd">                        ]</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                        ~</span>
<span class="sd">                        \time 3/8</span>
<span class="sd">                        c&#39;8</span>
<span class="sd">                        c&#39;4</span>
<span class="sd">                        \time 4/8</span>
<span class="sd">                        c&#39;2</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">is_sustained</span><span class="p">(</span><span class="n">tuplet</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
        <span class="n">last_leaf</span> <span class="o">=</span> <span class="n">leaves</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">has_indicator</span><span class="p">(</span><span class="n">last_leaf</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">):</span>
            <span class="n">last_leaf_has_tie</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">last_leaf_has_tie</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">tuplet</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">leaf</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">last_leaf_has_tie</span><span class="p">:</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">detach</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tie</span><span class="p">,</span> <span class="n">tuplet</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">_set_leaf_duration</span><span class="p">(</span><span class="n">tuplet</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">duration</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">tuplet</span><span class="o">.</span><span class="n">set_ratio</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">Ratio</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span></div>



<div class="viewcode-block" id="select_nongrace_leaves_by_tuplet">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.select_nongrace_leaves_by_tuplet">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">select_nongrace_leaves_by_tuplet</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Leaf</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selects nongrace leaves by tuplet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="n">leaf_lists</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">leaves</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">grace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">_is_list_of_leaf_lists</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">leaf_lists</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">leaf_lists</span></div>



<div class="viewcode-block" id="split_measures">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.split_measures">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">split_measures</span><span class="p">(</span>
    <span class="n">voice</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">durations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Duration</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tag</span><span class="p">:</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tag</span><span class="p">(),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splits measures in ``voice``.</span>

<span class="sd">    Uses ``durations`` when ``durations`` is not none.</span>

<span class="sd">    Tries to find time signature information (from the staff that contains</span>
<span class="sd">    ``voice``) when ``durations`` is none.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_function_name</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">durations</span><span class="p">:</span>
        <span class="n">staff</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">parentage</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">staff</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Staff</span><span class="p">)</span>
        <span class="n">voice_</span> <span class="o">=</span> <span class="n">staff</span><span class="p">[</span><span class="s2">&quot;TimeSignatureVoice&quot;</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">voice_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">)</span>
        <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">voice_</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">_is_duration_list</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="n">total_duration</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span>
    <span class="n">music_duration</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">duration</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">total_duration</span> <span class="o">!=</span> <span class="n">music_duration</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Total duration of splits is </span><span class="si">{</span><span class="n">total_duration</span><span class="si">!s}</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; but duration of music is </span><span class="si">{</span><span class="n">music_duration</span><span class="si">!s}</span><span class="s2">:&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">durations: </span><span class="si">{</span><span class="n">durations</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">voice: </span><span class="si">{</span><span class="n">voice</span><span class="p">[:]</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">voice</span><span class="p">[:],</span> <span class="n">durations</span><span class="o">=</span><span class="n">durations</span><span class="p">)</span></div>



<div class="viewcode-block" id="swap_length_1_tuplets_for_containers">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.swap_length_1_tuplets_for_containers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">swap_length_1_tuplets_for_containers</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Swaps length-1 tuplets in ``tuplets`` for (vanilla) containers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Container</span><span class="p">()</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">tuplet</span><span class="p">,</span> <span class="n">container</span><span class="p">)</span></div>



<div class="viewcode-block" id="swap_skip_filled_tuplets_for_containers">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.swap_skip_filled_tuplets_for_containers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">swap_skip_filled_tuplets_for_containers</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Swaps skip-filled tuplets in ``tuplets`` for (vanilla) containers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Skip</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tuplet</span><span class="p">):</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Container</span><span class="p">()</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">tuplet</span><span class="p">,</span> <span class="n">container</span><span class="p">)</span></div>



<div class="viewcode-block" id="swap_trivial_tuplets_for_containers">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.swap_trivial_tuplets_for_containers">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">swap_trivial_tuplets_for_containers</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Swaps trivial tuplets in ``tuplets`` for containers.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(tuplets)[-2:]</span>
<span class="sd">        ...     rmakers.swap_trivial_tuplets_for_containers(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (3, 8), (3, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/3</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/3</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">is_trivial</span><span class="p">():</span>
            <span class="n">container</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Container</span><span class="p">()</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">mutate</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">tuplet</span><span class="p">,</span> <span class="n">container</span><span class="p">)</span></div>



<div class="viewcode-block" id="toggle_diminished_tuplets">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.toggle_diminished_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">toggle_diminished_tuplets</span><span class="p">(</span><span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles prolation of diminished tuplets in ``tuplets``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs, toggle_diminished_tuplets=False):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8], extra_counts=[1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     if toggle_diminished_tuplets is True:</span>
<span class="sd">        ...         rmakers.toggle_diminished_tuplets(tuplets)</span>
<span class="sd">        ...     tweak_string = r&quot;\tweak text #tuplet-number::calc-fraction-text&quot;</span>
<span class="sd">        ...     for tuplet in tuplets:</span>
<span class="sd">        ...         abjad.tweak(tuplet, tweak_string)</span>
<span class="sd">        ...     score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">        ...     abjad.override(score).TupletBracket.bracket_visibility = True</span>
<span class="sd">        ...     abjad.override(score).TupletBracket.staff_padding = 4.5</span>
<span class="sd">        ...     abjad.setting(score).tupletFullLength = True</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Does not toggle diminished tuplets:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, toggle_diminished_tuplets=False)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                \override TupletBracket.bracket-visibility = ##t</span>
<span class="sd">                \override TupletBracket.staff-padding = 4.5</span>
<span class="sd">                tupletFullLength = ##t</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Toggles diminished tuplets:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(2, 8), (2, 8), (2, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, toggle_diminished_tuplets=True)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                \override TupletBracket.bracket-visibility = ##t</span>
<span class="sd">                \override TupletBracket.staff-padding = 4.5</span>
<span class="sd">                tupletFullLength = ##t</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/4</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 2/8</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span><span class="o">.</span><span class="n">is_diminished</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">tuplet</span><span class="o">.</span><span class="n">toggle_prolation</span><span class="p">()</span></div>



<div class="viewcode-block" id="toggle_augmented_tuplets">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.toggle_augmented_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">toggle_augmented_tuplets</span><span class="p">(</span><span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toggles prolation of augmented tuplets in ``tuplets``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs, toggle_augmented_tuplets=False):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(durations, [1], 16, extra_counts=[0, -1])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.swap_trivial_tuplets_for_containers(tuplets)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(voice)</span>
<span class="sd">        ...     if toggle_augmented_tuplets is True:</span>
<span class="sd">        ...         rmakers.toggle_augmented_tuplets(tuplets)</span>
<span class="sd">        ...     tweak_string = r&quot;\tweak text #tuplet-number::calc-fraction-text&quot;</span>
<span class="sd">        ...     for tuplet in tuplets:</span>
<span class="sd">        ...         abjad.tweak(tuplet, tweak_string)</span>
<span class="sd">        ...     score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">        ...     abjad.override(score).TupletBracket.bracket_visibility = True</span>
<span class="sd">        ...     abjad.override(score).TupletBracket.staff_padding = 4.5</span>
<span class="sd">        ...     abjad.setting(score).tupletFullLength = True</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Does not toggle augmented tuplets:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(1, 4), (1, 4), (1, 4), (1, 4)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, toggle_augmented_tuplets=False)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                \override TupletBracket.bracket-visibility = ##t</span>
<span class="sd">                \override TupletBracket.staff-padding = 4.5</span>
<span class="sd">                tupletFullLength = ##t</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 1/4</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/4</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Toggles augmented tuplets:</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(1, 4), (1, 4), (1, 4), (1, 4)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs, toggle_augmented_tuplets=True)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            \with</span>
<span class="sd">            {</span>
<span class="sd">                \override TupletBracket.bracket-visibility = ##t</span>
<span class="sd">                \override TupletBracket.staff-padding = 4.5</span>
<span class="sd">                tupletFullLength = ##t</span>
<span class="sd">            }</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 1/4</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            c&#39;16</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span><span class="o">.</span><span class="n">is_augmented</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">tuplet</span><span class="o">.</span><span class="n">toggle_prolation</span><span class="p">()</span></div>



<div class="viewcode-block" id="trivialize_tuplets">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.trivialize_tuplets">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trivialize_tuplets</span><span class="p">(</span><span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trivializes tuplets that can be rewritten as 1:1 in ``tuplets``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        Leaves trivializable tuplets as-is when no tuplet command is given. The</span>
<span class="sd">        tuplets in measures 2 and 4 can be written as trivial tuplets, but they</span>
<span class="sd">        are not:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">        ...         durations, [3, 3, 6, 6], 16, extra_counts=[0, 4]</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tuplet 3/2</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                            c&#39;4.</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">        Rewrites trivializable tuplets as trivial (1:1) tuplets when ``trivialize`` is</span>
<span class="sd">        true:</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_talea_tuplets(</span>
<span class="sd">        ...         durations, [3, 3, 6, 6], 16, extra_counts=[0, 4]</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.trivialize_tuplets(tuplets)</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (4, 8), (3, 8), (4, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8.</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 1/1</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 4/8</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                            c&#39;4</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="n">tuplet</span><span class="o">.</span><span class="n">trivialize</span><span class="p">()</span></div>



<div class="viewcode-block" id="tweak_skip_filled_tuplets_stencil_false">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.tweak_skip_filled_tuplets_stencil_false">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tweak_skip_filled_tuplets_stencil_false</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tweaks each skip-filled tuplet in ``tuplets`` with ``stencil ##f``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Skip</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">tuplet</span><span class="p">):</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">tweak</span><span class="p">(</span><span class="n">tuplet</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\tweak stencil ##f&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="tweak_trivial_tuplets_stencil_false">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.tweak_trivial_tuplets_stencil_false">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tweak_trivial_tuplets_stencil_false</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tweaks trivial tuplets in ``tuplets`` with ``stencil ##f``.</span>

<span class="sd">    ..  container:: example</span>

<span class="sd">        &gt;&gt;&gt; def make_lilypond_file(pairs):</span>
<span class="sd">        ...     time_signatures = rmakers.docs.make_time_signatures(pairs)</span>
<span class="sd">        ...     durations = abjad.duration.durations(time_signatures)</span>
<span class="sd">        ...     tuplets = rmakers.make_even_division_tuplets(durations, [8])</span>
<span class="sd">        ...     leaf_lists = [_[:] for _ in tuplets]</span>
<span class="sd">        ...     rmakers.tweak_tuplet_number_text_calc_fraction_text(tuplets)</span>
<span class="sd">        ...     lilypond_file = rmakers.docs.make_example_lilypond_file(</span>
<span class="sd">        ...         tuplets, time_signatures</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     voice = lilypond_file[&quot;Voice&quot;]</span>
<span class="sd">        ...     rmakers.attach_beams_to_runs_by_leaf_list(leaf_lists)</span>
<span class="sd">        ...     tuplets = abjad.select.tuplets(tuplets)[-2:]</span>
<span class="sd">        ...     rmakers.tweak_trivial_tuplets_stencil_false(tuplets)</span>
<span class="sd">        ...     return lilypond_file</span>

<span class="sd">        &gt;&gt;&gt; pairs = [(3, 8), (3, 8), (3, 8), (3, 8)]</span>
<span class="sd">        &gt;&gt;&gt; lilypond_file = make_lilypond_file(pairs)</span>
<span class="sd">        &gt;&gt;&gt; abjad.show(lilypond_file) # doctest: +SKIP</span>

<span class="sd">        ..  docs::</span>

<span class="sd">            &gt;&gt;&gt; score = lilypond_file[&quot;Score&quot;]</span>
<span class="sd">            &gt;&gt;&gt; string = abjad.lilypond(score)</span>
<span class="sd">            &gt;&gt;&gt; print(string)</span>
<span class="sd">            \context Score = &quot;Score&quot;</span>
<span class="sd">            {</span>
<span class="sd">                \context RhythmicStaff = &quot;Staff&quot;</span>
<span class="sd">                \with</span>
<span class="sd">                {</span>
<span class="sd">                    \override Clef.stencil = ##f</span>
<span class="sd">                }</span>
<span class="sd">                {</span>
<span class="sd">                    \context Voice = &quot;Voice&quot;</span>
<span class="sd">                    {</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/3</span>
<span class="sd">                        {</span>
<span class="sd">                            \time 3/8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/3</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak stencil ##f</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/3</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                        \tweak stencil ##f</span>
<span class="sd">                        \tweak text #tuplet-number::calc-fraction-text</span>
<span class="sd">                        \tuplet 3/3</span>
<span class="sd">                        {</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            [</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            c&#39;8</span>
<span class="sd">                            ]</span>
<span class="sd">                        }</span>
<span class="sd">                    }</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">is_trivial</span><span class="p">():</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">tweak</span><span class="p">(</span><span class="n">tuplet</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\tweak stencil ##f&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="tweak_tuplet_number_text_calc_fraction_text">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.tweak_tuplet_number_text_calc_fraction_text">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">tweak_tuplet_number_text_calc_fraction_text</span><span class="p">(</span>
    <span class="n">tuplets</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tweaks tuplet number text for tuplets in ``argument``. Sets tuplet number</span>
<span class="sd">    text equal to ``#tuplet-number::calc-fraction-text`` when any of these</span>
<span class="sd">    conditions is true:</span>

<span class="sd">      * tuplet is an augmentation (like 3:4), or</span>
<span class="sd">      * tuplet is nondyadic (like 4:3), or</span>
<span class="sd">      * tuplet multiplier equals 1</span>

<span class="sd">    Does not tweak tuplets for which none of these conditions holds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_tuplet_list</span><span class="p">(</span><span class="n">tuplets</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplets</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">tuplets</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">abjad</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span><span class="o">.</span><span class="n">TupletNumber</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">tuplet</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span><span class="o">.</span><span class="n">is_augmented</span><span class="p">()</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span><span class="o">.</span><span class="n">is_dyadic</span><span class="p">()</span>
            <span class="ow">or</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">multiplier</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="p">):</span>
            <span class="n">abjad</span><span class="o">.</span><span class="n">tweak</span><span class="p">(</span><span class="n">tuplet</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\tweak text #tuplet-number::calc-fraction-text&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="wrap_in_time_signature_staff">
<a class="viewcode-back" href="../../api/rmakers/functions.html#rmakers.functions.wrap_in_time_signature_staff">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">wrap_in_time_signature_staff</span><span class="p">(</span>
    <span class="n">components</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">Component</span><span class="p">],</span>
    <span class="n">time_signatures</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Iterable</span><span class="p">[</span><span class="n">abjad</span><span class="o">.</span><span class="n">TimeSignature</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wraps ``components`` in two-voice staff.</span>

<span class="sd">    One voice for ``components`` and another voice for ``time_signatures``.</span>

<span class="sd">    See ``rmakers.rewrite_meter()`` for examples of this function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">_is_component_list</span><span class="p">(</span><span class="n">components</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">_is_time_signature_list</span><span class="p">(</span><span class="n">time_signatures</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">time_signatures</span><span class="p">)</span>
    <span class="n">staff</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Staff</span><span class="p">(</span><span class="n">simultaneous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">abjad</span><span class="o">.</span><span class="n">Score</span><span class="p">([</span><span class="n">staff</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Score&quot;</span><span class="p">)</span>
    <span class="n">time_signature_voice</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TimeSignatureVoice&quot;</span><span class="p">)</span>
    <span class="n">staff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time_signature_voice</span><span class="p">)</span>
    <span class="n">voice</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Voice</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;RhythmMaker.Music&quot;</span><span class="p">)</span>
    <span class="n">staff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">voice</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">time_signature</span> <span class="ow">in</span> <span class="n">time_signatures</span><span class="p">:</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">time_signature</span><span class="o">.</span><span class="n">pair</span>
        <span class="n">skip</span> <span class="o">=</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Skip</span><span class="p">(</span><span class="s2">&quot;s1&quot;</span><span class="p">,</span> <span class="n">dmp</span><span class="o">=</span><span class="n">duration</span><span class="p">)</span>
        <span class="n">time_signature_voice</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span>
        <span class="n">abjad</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">time_signature</span><span class="p">,</span> <span class="n">skip</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s2">&quot;Staff&quot;</span><span class="p">)</span>
    <span class="n">voice</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tuplet</span> <span class="ow">in</span> <span class="n">abjad</span><span class="o">.</span><span class="n">iterate</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">voice</span><span class="p">,</span> <span class="n">abjad</span><span class="o">.</span><span class="n">Tuplet</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">tuplet</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span><span class="o">.</span><span class="n">is_normalized</span><span class="p">(),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tuplet</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">tuplet</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">voice</span></div>

</pre></div>

    </div>
    
    </div>
    

<footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2008-2025, Trevor Baa.
      <span class="lastupdated">
        Last updated on Oct 31, 2025.
      </span>

    </p>
  </div> 

</footer>

</div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script> 

</body>
</html>